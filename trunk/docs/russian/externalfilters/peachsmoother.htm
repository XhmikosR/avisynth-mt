<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang=ru>
<head>

  <meta content="text/html;charset=Windows-1251" http-equiv="Content-Type">
  <title>PeachSmoother</title>


  <link rel="stylesheet" type="text/css" href="../../avisynth.css">

<!-- Automatically generated, don't change: $Id: peachsmoother.htm,v 1.2 2006/12/13 21:01:40 fizick Exp $ -->
</head>

<body>

<h1>PeachSmoother</h1>

<h2>Общее описание</h2>

<b>автор:</b> Lindsey Dubb
<br>

<b>версия:</b> 1.0c<br>

<b>закачка:</b> <a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a>
<br>

<b>категория:</b> Пространственно-временные сглаживатели<br>

<b>требования:</b> YUY2 цветовой формат
<hr>
<h2>Введение</h2>

<p>Это еще один фильтр, который очищает изображение, усредняя
видимый шум между кадрами и в пределах кадров.</p>

<p>Фильтр Peach (переводится как персик, любил автор фрукты - прим.перев.)
разработан, чтобы бороться со странностями транслируемого (аналогового)
телевидения. Он автоматически подстраивает себя для хорошего или
плохого качества сигнала и приема, и может даже приемлемо обращаться с
некоторыми видами интерференционных помех. Он замечательный!</p>

<p>Фильтр анализирует изображение, делает выводы о количестве
шума в (видео-)картинке, и использует эту оценку, чтобы определить, как
удалить этот шум. Чтобы отличить шум от движения, фильтр использует
корреляции внутри и между полями, а также локальные различия цвета.
Степень определенности о том, движение ли это, шум или
детали, используется, чтобы решить, какую смесь предыдущего, текущего и
соседнего цветов выдать на выход.</p>

<p>Чтобы использовать Peach, Ваш компьютер должен быть способен
выполнять инструкции SSE. По простому, это означает, что Вы должны
иметь Pentium 3, Athlon, недавний Celeron, или любой более поздний
процессор.</p>

<p>Это фильтр работает в цветовом формате YUY2. Так что если Ваш
клип закодирован в цветах RGB, Вы должны сначала обработать его
командой ConvertToYUY2().</p>

<p>Фильтр Peach Smoother для AVISynth
был написан Lindsey Dubb, copyright 2002. Если Вы имеете вопросы,
комментарии, проблемы или предложения, добро пожаловать <a href="mailto:lindsey@alumni.caltech.edu">послать мне письмо</a>
или сообщить на Doom9 <a href="http://forum.doom9.org/forumdisplay.php?s=&amp;forumid=33">форум
по AVISynth</a>. </p>

<hr>
<h2>Параметры</h2>

<p><var>NoiseReduction (Подавление шума)</var><br>

<i>Целое от 1 до 200; 35 по умолчанию</i></p>

<p>Иногда фильтр не знает, произошло ли изменение изображения
из-за шума или движения. Когда это происходит, есть
выбор &mdash; Предположить движение, и изображение будет
шумнее, если Вы ошиблись. Предположить шум, и ошибка размажет движение.</p>

<p>Параметр <var>NoiseReduction</var> позволяет Вам
сказать фильтру, как сделать этот выбор. Установите его низким, и
компьютер будет действовать безопасно, избегая любых частей
изображения, которые могли бы быть в движении. Установите его высоким,
и шум будет сильно подавлен &mdash; за счет размытия и
потери деталей в медленно движущихся областях. Этот выбор зависит от
количества шума &mdash; чем больше шума на изображении,
тем большее размытие будет необходимо, чтобы его снизить.</p>

<p>Нет совершенного способа выбрать его &mdash;
просто попробуйте разные величины, пока изображение буде выглядит так
хорошо, как возможно. Комедии и драмы являются вероятно наилучшим
материалом для подбора настроек, так как крупные планы лиц делают любое
размытие легко заметным. (Это потому, что мы особенно хорошо видим
искажения в лицах.)</p>

<p>Помните, что этот фильтр автоматически подстраивается к
количеству шума в картинке. Так что если Вы имеете нравящуюся Вам
настройку, Вы можете использовать ее как для чистого, так и шумного
видео.</p>

<p>Однако, есть два вида видео, которое требует некоторого
специального рассмотрения: мультфильмы и спорт. Для мультфильмов Вы
можете использовать много более высокий <var>NoiseReduction</var>,
так как анимация имеет тенденцию иметь менее тонкие детали. А для
спорта (или любого другого действия с непрерывным движением),
есть очень малая выгода от (этого) шумопонижающего фильтра, так что вы
можете просто пропустить его.</p>

<p>Перед тем как точно выставить этот параметр, убедитесь что
фильтр способен оценивать шум в Вашем клипе. Чтобы сделать это,
воспользуйтесь (параметром) <var>Dot</var>, описанным ниже.</p>

<p><var>Stability (Стабильность)</var><br>

<i>Целое от -100 до 100; 20 по умолчанию</i></p>

<p>Этот параметр говорит фильтру, как сильно смешивать цвета,
когда неясно, движение ли это. Чтобы сохранить небольшое количество
шума по всему изображению, уменьшите этот параметр. Чтобы получить
строго чисто выглядящее изображение, используйте более высокую
величину. Не устанавливайте ее слишком высокой, однако, или вы получите
плакатность (posterization).</p>

<p>Независимо от Ваший установки <var>Stability</var>, фильтр будет всегда оставлять определенное количество вариации, чтобы
поддержать глубину цвета оригинального изображения.</p>

<p><var>DoSpatial (Делать пространственно)</var><br>

<i>Логический; TRUE (Да) по умолчанию</i></p>

<p>Этот параметр решает, хотите ли Вы чтобы фильтр использовал
пространственное сглаживание. Это очень слабый сглаживатель, и
используется в основном на низкоконтрастных, движущихся частях
изображения. Фильтр является немного более быстрым, если
пространственная фильтрация выключена.</p>

<p><var>Spatial (Пространственный)</var><br>

<i>Целое от 0 до 400; 100 по умолчанию</i></p>

<p>Определяет, как много использовать пространственного
сглаживания. Он измеряется в процентах, относительно к степени
временнОго сглаживания. Но Peach предпочитает использовать временное
сглаживание где возможно, так что пространственное сглаживание делает
взнос, только если временное сглаживание отказывает.</p>

<p><var>Dot (Точка)</var><br>

<i>Лочический; FALSE по умолчанию</i></p>

<p>Это является ... маленькой зеленой точкой!</p>

<p>С этой опцией, крошечная зеленая точка появится, когда оценка
шума фильтром подтвердится текущей картинкой. Она будет
показана у верхнего левого края экрана &mdash; конкретно
16 вниз и 16 вбок от верхнего левого угла. Точка является индикацией
того, что фильтр установил величину шума. Вообще, она будет выключена
если вся картинка с быстрым движением &mdash; Когда так
много движения, фильтр склоняется не верить текущей оценке. В таком
случае, фильтр действует путем взвешивания предыдущих хороших величин.</p>

<p>Если картинка постоянно в движении, пройдет достаточно, пока
фильтр сможет выделить уровень шума. Интерференционные помехи также
имеют тенденцию сделать оценку шума более
длительной &mdash; время оценки зависит от вида и
количества помех.</p>

<p><var>Readout (Считывание)</var><br>

<i>Лочический; FALSE по умолчанию</i></p>

<p>Чтобы помочь решить, как сильно сглаживать, данный фильтр
измеряет шум в видео. Если Вы включите <var>Readout</var>,
эти измерения будут показаны на выходе.</p>

<p>Вы увидите два числа. Первое - это мера среднего уровня шума.
Второе - это мера наименьшего количества шума, видимого где-нибудь на
картинке. Это дает некоторую идею о том, как сильно шум изменяется в
видео. Эти оценки будут изменяться по мере прокрутки видео.</p>

<p>Эти числа измеряются как ожидаемое абсолютное изменение
единичного пиксела (считая как цветность так и яркость) между двумя
последовательными кадрами.</p>

<p>Это дает объективное измерение шума. Это также способ выявить
величины для параметров <var>NoiseLevel</var> и <var>Baseline</var> ,
описанных ниже.</p>

<p><var>NoiseLevel</var> (Уровень шума) и <var>
Baseline (Базисный уровень)</var><br>

<i>Два параметра &mdash; каждый является числом с
плавающей точкой от 0.0 до 100.0; Не используется по умолчанию</i></p>

<p>Вместо того чтобы оценивать уровень шума, Вы можете сказать
фильтру Peach конкретно, как много шума есть в картинке.</p>

<p>Чтобы сделать это, выберите величины как для <var>NoiseLevel</var>
так и для <var>Baseline</var>. Чтобы получить
эти величины, используйте опцию <var>Readout</var>,
описанную выше. Заметьте, что <var> Baseline</var> не
должен быть больше чем <var>NoiseLevel</var>.</p>

<p>Почему Вы захотели бы указать эти числа? Потому что
Peach тратит время, чтобы выявить количество шума. И в редких
случаях он может введен в заблуждение. (Это обычно вызывается сценами с
облаками тумана и пыли, которые Peach может ошибочно посчитать как
шум.) Путем указания величин шума, оценка не будет колебаться. Пропуск
оценки шума также сделает обработку немного быстрее.</p>

<p>С другой стороны, некоторое видео не имеет изменения
количества шума. В этом случае, Вам будет лучше без обычного
детектирования шума фильтром Peach.</p>

<p><var>ShowMotion (Показать движение)</var><br>

<i>Логический; FALSE по умолчанию</i></p>

<p>Еще одна диагностика неопределенности. Если это включено, то
фильтр будет чередовать его оценку, произошло ли движение. Белые
области являются точно движением, черные области точно стационарны.
Серые области есть серые области.</p>

<p><var>Debug (Отладка)</var><br>

<i>Логический; FALSE по умолчанию</i></p>

<p>Эта опция только значима для stout основы. Для
объяснения его выхода, смотри комментарии в конце 
<a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/deinterlace/DScaler/Plugins/FLT_AdaptiveNoise/">
<cite>FLT_AdaptiveNoise.c</cite> </a>.</p>

<h2>Про Peach</h2>

<h3>Насколько сильное понижение шума я должен использовать?</h3>

<p>Пусть Ваши глаза будут судьей. Я люблю держать настройки
достаточно низкими &mdash; Размытые лица выглядят хуже,
чем небольшие помехи.</p>

<p>Неожиданно, но малые количества вариации цвета могут иногда
улучшить изображение. Переключением назад и вперед между цветами,
картинка способна дать впечатление цвета где-то между ними. Также, шум
может скрыть искусственные структуры в картинке, что
позволяет Вам легче игнорировать ошибки.</p>

<p>С этим в мыслях, фильтр Peach пытается оставить небольшое
количество вариации цвета. В результате, он никогда не даст Вам
полностью стабильной картинки. Это вероятно плохо для сжатия, но это
улучшает качество картинки.</p>

<h3>Я вижу много размытия в ранних частях моего видео с
непрерывным движением (или очень темного). Что я должен сделать, чтобы
улучшить результаты?</h3>

<p>Если Вы видите много размытия, попытайтесь использовать опцию <var>Dot</var>.
Если зеленая точка не показывается, то проблема в том, что Peach не
способен выявить, насколько много было шума.</p>

<p>Существует несколько способов решить это. Наилучший - это
включить опцию <var>Readout</var>, и наблюдать более
позднюю часть этого видео, где картинка неподвижна. Заметьте значения <var>NoiseLevel</var>
и <var>Baseline</var> стационарной части. Затем
укажите их в команде, и вся последовательность должна выглядеть
прекрасно.</p>

<p>Если Ваше видео не содержит никаких стационарных частей, то вы
должны просто не использовать этот фильтр. Временной сглаживатель не
сделает много хорошего для чисто высоко динамичного материала.</p>

<p>Другой способ решить эту проблему - поместить некоторое
неподвижное видео (из того же клипа) в начале последовательности. Это
позволит фильтру Peach оценить шум прежде чем
покажется быстрый материал.</p>

<h3>Картинка выглядит немного мягкой. Если ли что-то, что я могу
сделать с этим?</h3>

<p>Попытайтесь снизить параметр <var>Stability</var>.</p>

<h2>Шум вообще</h2>

<h3>Каков наилучший способ избавиться от шума?</h3>

<p>Удостоверьтесь, что Вы имеете хороший сигнал. Шум может прийти
из скруток кабеля, плохих соединений, плохого питания и
заземления, плохо сконструированной карты видеовхода, электрических
принадлежностей (всего от переключателей света до различных
компьютерных компонент) или от плохого видео источника. Эти вопросы за
пределами данного файла справки. Я предлагаю заглянуть на Вопросы и
Ответы по Домашнему театру и доску форума <a href="http://www.avsforum.com/"><cite>AV Science Forum</cite>
</a> , где эти темы обсуждаются подробно.</p>

<h3>Должен ли я использовать фильтр шума?</h3>

<p>Это зависит от того, что Вы смотрите. Спорт и передачи о
природе вообще &mdash; реально все с множеством движущейся
малоконтрастной текстуры &mdash; не обрабатываются хорошо
временными сглаживателями. Это потому, что эти текстуры выглядят весьма
подобно шуму.</p>

<p>Peach работает правильно с трудным материалом, отключая себя
где он регистрирует движение. Это вызывает неожиданно мало проблем со
спортом на поле, пока фоновый шум не слишком плох. Но он не
совершенен &mdash; дорожные гонки особо
подвержены размытию. Если это случается, лучше не использовать никаких
временных сглаживателей.</p>

<p>В других случаях, воспользоваться фильтром шума вообще стоит.</p>

<h3>Сколько фильтров шума я должен использовать?</h3>

<p>Будьте очеь осторожны используя больше одного. Выполнение
нескольких временных фильтров шума может вызвать более поздние фильтры
иметь чрезмерную уверенность в их оценке шума/движения. Это обычно
ведет к плакатности (posterization), пятнистости (speckling), и
полосатости (banding).</p>

<p>Выполнение пространственного фильтра после Peach Smoother
может еще работать довольно хорошо, так как его пространственное
сглаживание весьма слабое &mdash; просто будьте уверены не
выполнить пространственную фильтрацию первой.</p>

<h3>Где в моем скрипте я должен поместить фильтр шума?</h3>

<p>Вообще говоря, лучше фильтровать шум как можно раньше. Это
особенно справедливо для Peach, так как его оценка шума может быть
повергнута некоторыми фильтрами. Например, если Вы добавите субтитры к
видео, Peach может зарегистрировать отсутствие шума в области
субтитров.</p>

<p>С чересстрочным материалом, хорошая идея выполнить данный
фильтр пред деинтерлейсом. Это потому, что хорошее подавление шума
может здорово улучшить точность деинтерлейсера. </p>

<p>Для обратного телекино ситуация более трудная для суждения. Но
как эмпирическое правило, лучше все же выполнить понижение шума первым.
</p>

<p>Исключением к данному правилу является гребенчатая фильтрация.
Любой гребенчатый фильтр должен выполняться перед снижением шума, так
как фильтр шума будет иначе интерпретировать цветовые перекрестные
помехи как движение.</p>

<h3>Могут какие-нибудь другие хитрости помочь снижению шума?</h3>

<p>Если Вы используете карту на Bt8x8, Вы можете выключить
обострение нечетной и четной яркости (Odd and Even Luma Peaking).
Включение горизонтального фильтра (Horizontal Filter) карты будет
снижать шум, но также потеряет некоторые детали.</p>

<h2>Изменения фильтра</h2>

<ul>

  <li>Версия 0.9a &mdash; Начальный выпуск</li>

  <li>Версия 0.9b &mdash; Позволил параметрам
настраиваться; Другие умолчания; Скорректировал чтобы работать с Y = 16
черным; Дополнительный оранжевый туман (orange smoke)</li>

  <li>Версия 0.9c &mdash; Добавил проверку параметров</li>

  <li>Версия 0.9d &mdash; Исправил чтобы допустить
пространственное сглаживание больше 100%</li>

  <li>Версия 0.9e &mdash; Фильтр теперь отключается
при прыжке между кадрами</li>

  <li>Версия 0.9f &mdash; Фильтр теперь обрабатывает
чересстрочный материал корректно; Опция сглаживания перемасштабирована
к чему-то более близкому к реальным процентам; Другие умолчания; Еще
больше оранжевого тумана</li>

  <li>Версия 0.9g &mdash; Разрешил пространственное
(но не временнОе) сглаживание при прыжках между кадрами; Выключение
пространственного сглаживания теперь улучшает скорость; разрешил
предсказание (prefetching) для ускорения; улучшил обработку параметров</li>

  <li>Версия 0.9h &mdash; Обеспечил (четкое) экранное считывание количества шума. Разрешил ввод
пользователем величин шума. Разрешил пространственное сглаживание
первого кадра.</li>

  <li>Версия 1.0a &mdash; Улучшил определение
количества используемого пространственного сглаживания. Улучшил код
горизонтальной корреляции. Улучшил точность считывания оценки шума.
Сделал временную цветовую комбинацию ближе к теоретической цели.
(Посторонний эффект: Вы можете захотеть снизить Ваш NoiseReduction на
примерно 10.) Увеличил роль пространственной корреляции в оценках
движения. Изменил имя опции Estimates на Readout.</li>

  <li>Версия 1.0b &mdash; Обеспечил показ внутренней
оценке движения с опцией ShowMotion. Разрешил отрицательные значения
Stability.</li>

  <li>Версия 1.0c &mdash; Передвинул readout немного
дальше от края экрана.</li>

</ul>

<p><kbd>$English Date: 2004/08/17 20:31:18 $<br>

Русский перевод 28.07.2005 Fizick http://bag.hotmail.ru</kbd></p>

</body>
</html>