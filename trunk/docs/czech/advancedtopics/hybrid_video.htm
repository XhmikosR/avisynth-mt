<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-2">
   <META NAME="GENERATOR" CONTENT="Microsoft FrontPage 4.0">
   <TITLE>hybrid video</TITLE>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
</HEAD>
<BODY>
<h1>AviSynth, video s promìnnou frekvencí snímkù (vfr)&nbsp;a hybridní video</h1>
<p>
Existují dva druhy videa z pohledu snímkové frekvence. Konstantní snímková frekvence&nbsp;(cfr) videa
a&nbsp;promìnná snímková frekvence (vfr) videa.&nbsp;Pro cfr&nbsp;mají snímky konstantní dobu trvání, a pro&nbsp;vfr&nbsp;mají
snímky&nbsp;promìnnou dobu trvání. Vìt¹ina editaèních programù&nbsp;(vèetnì VirtualDubu a AviSynthu) pøedpokládá, ¾e
video má cfr. Jednou z pøíèin je, ¾e&nbsp;avi&nbsp;nepodporuje vfr. To se
v nejbli¾¹í budoucnosti nezmìní z&nbsp;
<a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=69132"> rùzných
dùvodù</a>       . I kdy¾&nbsp;avi kontejner&nbsp;nepodporuje
vfr, je nìkolik&nbsp;kontejnerù (napøíklad mkv, mp4 a wmv), které podporují vfr.</p>
<p>
Hybridní video&nbsp;je&nbsp;bì¾nì definováno 
jako&nbsp;provedený&nbsp;mix&nbsp;materiálu, který byl
zpracován pomocí&nbsp;pull-down&nbsp;a materiálu který tak zpracován nebyl (kde mù¾e být&nbsp;pulldown provedeno na
polích, jako ve&nbsp;standardním 3:2 pulldown,&nbsp;nebo&nbsp;na plném snímku). Není dùle¾ité
zda je&nbsp;pulldown&nbsp;tvrdý (pole/snímky jsou&nbsp;duplikovány pøed&nbsp;kódováním) nebo mìkký (pøidáním pøíslu¹ných znamení&nbsp;ve streamu,
který udává která pole/snímky&nbsp;by mìly být pøi pøehrávání duplikovány).&nbsp;Tak¾e to mù¾e být&nbsp;buï cfr&nbsp;nebo vfr.
Tak je hybridní video jednodu¹e video s&nbsp;rùznými základními&nbsp;snímkovými frekvencemi&nbsp;(napøíklad 8, 12, a 16 fps&nbsp;ve kterých
jsou èasto kresleny animované filmy. Základní snímková frekvence je frekvence&nbsp;pøed jakýmkoliv&nbsp;pulldown. Co
dìlá hybridní videa nároènými, je&nbsp;nutnost rozhodnout, jakou&nbsp;koneènou frekvenci snímkù pou¾ít.</p>
<h2>  Obsah</h2>
<ul>
 <li><A href="#hybrid">Video s promìnnou frekvencí snímkù a hybridní video</A>
 <li><A href="#recognize-vfr">  Jak rozpoznat vfr&nbsp;obsah (mkv/mp4)</A>
 <li><A href="#enc-hybrid-mpeg2">Otevøení&nbsp;hybridního videa (MPEG-2)&nbsp;v AviSynthu a jeho pøekódování</A>
  <ul>
   <li><A href="#enc-cfr">kódování&nbsp;do cfr - 23.976 fps&nbsp;nebo 29.97 fps</A>
   <li><A href="#enc-cfr">kódování&nbsp;do </A><A href="#enc-120">  cfr - 120 fps</A>
   <li><A href="#enc-cfr">kódování&nbsp;do </A><A href="#create-vfr-mkv">  vfr - mkv</A>
   <li><A href="#enc-cfr">kódování&nbsp;do&nbsp;</A><A href="#create-vfr-mp4">  vfr - mp4</A>
   <li><A href="#summary-methods">shrnutí</A></li>
  </ul>
 <li><A href="#reenc-vfr">Otevøení jiných hybridních videí ne¾ MPEG-2&nbsp;v AviSynthu a jejich pøekódování</A>
  <ul>
   <li> <A href="#open-vfr-avi"> otevøení&nbsp;avi vfr&nbsp;obsahu - 120 fps -&nbsp;v AviSynthu</A> 
 
   <li><A href="#open-vfr-avi">otevøení</A><A href="#open-vfr-non_mpeg2"> jiného ne¾ avi vfr obsahu v AviSynthu</A> 
 
   <li><font color="#000000"><A href="#reenc-vfr-dss-non_mpeg2">kódování videa se
    120 fps</A></font>
   <li><A href="#open-vfr-avi">pøevádìní&nbsp;vfr&nbsp;na cfr avi&nbsp;pro AviSynth</A>
   <li><A href="#reenc-mkv2vfr">kódování do MPEG-2 vfr videa</A></li>
  </ul>
 <li><A href="#audio-sync">Audio synchronizace</A>
 <li><A href="#references">Odkazy</A>&nbsp;</li>
</ul>
<h2>Promìnná frekvence snímkù a hybridní video<a name="hybrid"></a>    </h2>
<p>Je dùle¾ité pochopit, ¾e
video je obvykle v&nbsp;cfr. Je jeden pøíklad,&nbsp;kde je&nbsp;pøevod na&nbsp;vfr&nbsp;velmi u¾iteèný, a tou je&nbsp;hybridní video.
Hybridní video je video slo¾ené z èástí zalo¾ených na rùzných frekvencích snímkù (napøíklad 8,
12, a 16 fps ve kterých jsou kresleny nìkteré animované filmy). Nejbì¾nìj¹í&nbsp;pøíklad hybridního videa&nbsp;sestává z
èástí, které jsou&nbsp;prokládané/progresivní NTSC (29.97 fps) a jiných èástí&nbsp;jako je&nbsp;FILM (pøevedený pomocí telecine&nbsp;z
23.976 fps&nbsp;do 29.97 fps). Pro mìkký pulldown,&nbsp;je NTSC&nbsp;èást (také nazývaná&nbsp;jako video èást)&nbsp;pøehrávána&nbsp;rychlostí 29.97 fps
a&nbsp;èást zpracovaná pomocí telecine také&nbsp;duplikováním&nbsp;polí (pro zvet¹ení snímkové frekvence z&nbsp;23.976 fps&nbsp;na 29.97 fps). Pro
tvrdý&nbsp;pulldown, je to pøehráváno&nbsp;rychlostí 29.97 fps bez pøidávání jakýchkoliv polí.</p>
<p>
Pøíklady&nbsp;hybridního videa 
zahrnují&nbsp;mnoho&nbsp;moderních animovaných TV seriálù, øadu&nbsp;Sci-Fi TV seriálù, jako Stargate: SG1, Star Trek: TNG, a
Babylon 5), a mnoho "Making Of"&nbsp; (pøídavných) dokumentù zaøazených na&nbsp;DVD..</p>
<p>
Balík&nbsp;TIVTC&nbsp;je 
vytvoøen pro bezeztrátovou
práci&nbsp;s hybridním videem, zatímco&nbsp;balík Decomb&nbsp;vyu¾ívá pro pøevod&nbsp;do cfr&nbsp;postupy&nbsp;skrze smíchání.</p>
<h2>Jak rozpoznat<a name="recognize-vfr"></a>    vfr&nbsp;obsah (mkv/mp4)</h2>
<p>
Zde je nìkolik zpùsobù jak urèit, ¾e video v kontejnerech mkv/mp4&nbsp;je vfr:</p>
<p>
<u>mpeg-2:</u> 
 DGIndex&nbsp;hlásí&nbsp;procentní zastoupení Film/Video, co¾
mù¾e øíci&nbsp;kolik hybridního obsahu má soubor zpracovaný&nbsp;mírným&nbsp;pulldown. Nefunguje to v¹ak s&nbsp;tvrdým pulldown, a není
v¾dy pøesný pokud je smíchán silný/mírný pulldown.</p>
<u>mkv:</u> získají se èasové kódy&nbsp;souboru s pou¾itím <a href="http://haali.cs.msu.ru/mkv/mkv2vfr.exe">mkv2vfr</a>.
<p>
<u>mp4:</u><font color="#000000">        
pomocí&nbsp;mp4dump (z <a href="http://www.rarewares.org/mp4.html">MPEG4 tools by MPEG4ip
package</a>). Otevøete pøíkazový øádek a napi¹te (s pøíslu¹nou cestou)</font>
<pre><font color="#000000">mp4dump -verbose=2 holly_xvid.mp4 &gt; log.txt</font></pre>
<p>
Otevøete log soubor, a podívejte se&nbsp;na výstup jako zde (najdìte atom stts&nbsp;obsahující dobu
trvání ka¾dého snímku):</p>
<pre>type stts
       version = 0 (0x00)
       flags = 0 (0x000000)
       entryCount = 41 (0x00000029)
        sampleCount = 3 (0x00000003)
        sampleDelta = 1000 (0x000003e8)
        sampleCount[1] = 1 (0x00000001)
        sampleDelta[1] = 2000 (0x000007d0)
        sampleCount[2] = 3 (0x00000003)
        sampleDelta[2] = 1000 (0x000003e8)
        sampleCount[3] = 1 (0x00000001)
        sampleDelta[3] = 2000 (0x000007d0)
        etc ...</pre>
<p>
<i>sampleDelta</i> ukazuje&nbsp;jak dlouho&nbsp;jsou snímky zobrazovány a&nbsp;
<i>sampleCount</i> øíká kolik je takových&nbsp;snímkù.  Tedy ve vý¹e uvedeném pøíkladu:<br>
3&nbsp;snímky jsou 
zobrazeny&nbsp; po dobu&nbsp;1000 (tzn. ka¾dý z nich)<br>
1&nbsp;snímek je zobrazen po dobu&nbsp;2000<br>
3 snímky po dobu 1000<br>
 1 po dobu 2000<br>
etc ...</p>
<p>
Hodnoty èasu nejsou v sekundách,&nbsp;ale v 
jakýchsi&nbsp;"ticks",
které mù¾ete pøepoèítat na sekundy pomocí&nbsp; "timescale" hodnoty.&nbsp;&nbsp;Tato "timescale" hodnota je
ulo¾ena&nbsp;v timescale atomu&nbsp;video&nbsp;stopy (pøesvìdète se, ¾e se díváte na správný&nbsp;timescale&nbsp;pro va¹i stopu, proto¾e ka¾dá stopa
má vlastní&nbsp;timescale). Podívejte  se na výstup jako zde:</p>
<pre>type mdia
    type mdhd
...
     timeScale = 24976 (0x00006190)
     duration = 208000 (0x00032c80)
     language = 21956 (0x55c4)
     reserved = &lt;2 bytes&gt; 00 00 </pre>
<p>
       V tomto pøíkladu 
je&nbsp;timeScale&nbsp; 24976. Vìt¹ina snímkù má délku&nbsp;1000. 1000/24976 =       0.04 
co¾ znamená, ¾e ka¾dý snímek&nbsp;z prvních tøí 3 je zobrazen po dobu&nbsp;0.04 sekund, co¾ je&nbsp;ekvivalent&nbsp;pro 
25 fps (1/25 =
           0.04). Dal¹í snímek má&nbsp;délku
2000. 2000/24976 =           
           0.08 co¾ znamená,  ¾e&nbsp;je
zobrazen po dobu&nbsp;0.08 sekund, co¾ je&nbsp;ekvivalent&nbsp;pro 12.5 fps (1/12.5 =      
              
 0.08).&nbsp;atd ...</p>
<p>
Log&nbsp;soubor vý¹e,&nbsp;pochází z videa, které je skuteènì hybridní.</p>
<h2>Otevøení&nbsp;MPEG-2 hybridního videa&nbsp;v AviSynthu a jeho pøekódování</h2>
<p>
Pøedpokládejme, ¾e máte hybridní video, je nìkolik 
zpùsobù jak ho zakódovat. Jsou uvedeny ní¾e. Prvním zpùsobem je&nbsp;pøevést ho&nbsp;na&nbsp;cfr video (buï 23.976&nbsp;nebo 29.97 fps). Druhým
je zakódovat&nbsp;ho se&nbsp;120 fps s pou¾itím&nbsp;avi kontejneru a&nbsp;vypu¹tìním snímkù (kde&nbsp;zdvojené snímky jsou vypu¹tìny
pøi pøehrávání). Tøetím je&nbsp;vytvoøit skuteèné vfr&nbsp;s pou¾itím&nbsp;mkv&nbsp;nebo mp4 kontejneru.</p>
<h3>kódování do<a name="enc-cfr"></a>   cfr (23.976 fps&nbsp;nebo 29.97 fps)</h3>
<p>
  Pokud vybereme&nbsp;rychlost videa,&nbsp;video sekvence
budou OK,&nbsp;ale FILMové sekvence&nbsp;se budou lehce zadrhávat (kvùli zdvojeným snímkùm). A podobnì, pokud vybereme&nbsp;rychlost FILMu,&nbsp;FILMové
sekvence budou OK, ale&nbsp;video sekvence&nbsp;se budou zadrhávat (kvùli "chybìjícím" snímkùm). Navíc, kdy¾&nbsp;zakódujeme s&nbsp;29.97 fps,&nbsp;dostaneme ni¾¹í
kvalitu pøi stejné velikosti souboru,&nbsp;proto¾e je o&nbsp;25% vìt¹í poèet snímkù. Vybrat si z nich není
snadné. Pokud je klip&nbsp;pøevá¾nì FILMový&nbsp;mìli by jste zvolit&nbsp;23.976 fps, a pokud je klip pøevá¾nì&nbsp;VIDEO&nbsp;mìli by
jste zvolit&nbsp;29.97 fps. Zdroj je také faktorem. Pokud je vìt¹ina&nbsp;videoèástí&nbsp;zcela statická&nbsp;napøíklad "mluvící hlavy",&nbsp;mìli
by jste být schopni&nbsp;"decimovat"&nbsp;na 23.976 fps&nbsp;bez nìjakého zøetelného zadrhávání pøi pøehrávání.</p>
<p>
Kdy¾ vytvoøíte vá¹&nbsp;d2v projektový soubor uvidíte, ¾e klip je vìt¹inou&nbsp;video
(NTSC)&nbsp;nebo FILM (v informaèním panelu). Nicménì, øada tìchto&nbsp;hybridù je kódována&nbsp;zcela&nbsp;jako&nbsp;NTSC, s filmovými
èástmi&nbsp; zpracovanými "tvrdým telecine" (pole zpracované zvlá¹» pomocí telecine u¾&nbsp;také byla kódována)
tak¾e budete muset peèlivì provìøit&nbsp;zdroj&nbsp;aby jste zjistili co máte, a jak si s ním
pøejete zacházet.</p>
<p>
Pluginy Avisynthu&nbsp;Decomb a TIVTC poskytují
dva speciální decimaèní&nbsp;re¾imy&nbsp;pro lep¹í práci s hybridními klipy pomocí smíchání. Rychle ujídá datový tok,
ale ukazuje se jako velmi hladký. Zde je&nbsp;typický skript pro zapnutí tohoto&nbsp;re¾imu:</p>
<pre>Telecide(order=0, guide=1)
Decimate(mode=X) # nastaví &quot;threshold&quot; pro detekci film/video</pre>
<p>
nebo</p>
<pre>TFM(mode=1)
TDecimate(mode=0,hybrid=X) # nastaví &quot;vidThresh&quot; pro detekci film/video</pre>
<p>
Jsou&nbsp;2 faktory, které umo¾òují vhodné zpracování filmových a&nbsp;ne-filmových
èástí&nbsp;pomocí Decimate. První, kdy¾&nbsp;Telecide&nbsp;udává guide=         
        1, je schopen pøedat informaci&nbsp;pluginu Decimate&nbsp;o tom, které
snímky jsou získané z&nbsp;film a které&nbsp;z videa. Pro tento mechanismus práce, musí Decimate&nbsp;ihned následovat&nbsp;Telecide.
Je jasné, ¾e èím lépe&nbsp;(cestou nastavení parametrù)&nbsp;doká¾e&nbsp;Telecide&nbsp;rozpoznat typ, tím lep¹í práci&nbsp;Decimate&nbsp;mù¾e udìlat.</p>
<p>
Druhý faktor&nbsp;je prahová hodnota. Pokud v 
posloupnosti snímkù&nbsp;nejsou duplikované snímky, pak je s&nbsp;touto posloupností zacházeno jako&nbsp;s
videem.&nbsp;Prahová hodnota urèuje&nbsp;jaké procento&nbsp;rozdílu snímkù&nbsp;je pøípustné&nbsp;pro duplikování. V¹imnìte si ¾e&nbsp;prahová hodnota -&nbsp;threshold=  0
vypne&nbsp;druhý faktor.</p>
<p>
Nezapomeòte nastavit správné poøadí&nbsp;polí - DVD mají 
obecnì&nbsp;order=
   1, a zachytávané video&nbsp;má obecnì&nbsp;order=   
       0.&nbsp;Zahrnutý DecombTutorial?.html vysvìtluje&nbsp;jak urèit poøadí
polí.</p>
<p>
<i>Pøevá¾nì filmový materiál (mode=3)</i></p>
<p>Kdy¾ je klip&nbsp;vìt¹inou film, chceme 
decimovat&nbsp;filmové èásti normálnì, tak¾e budou hladké. Pro nefilmové èásti,
chceme zmen¹it jejich frekvenci snímkù&nbsp;smìsnou decimací ka¾dého cyklu snímkù od 5&nbsp;snímkù do&nbsp;4 snímkù. Takto rendrované
video sekvence&nbsp;vypadají hlad¹í&nbsp;ne¾ kdy¾&nbsp;jsou decimovány&nbsp;jako film. Pro tento re¾im práce nastavte Decimate&nbsp;na mode=  3,&nbsp;nebo
TDecimate&nbsp;na hybrid=   1.</p>
<p>Jiný&nbsp;&nbsp;IVTC plugin byl vyvinut speciálnì pro práci s hybridním&nbsp;materiálem
bez smíchaných snímkù: je to SmartDecimate. Získané výsledné snímky budou&nbsp;"èisté", ale pøi pøehrávání&nbsp;nebudou tak plynulé&nbsp;a
výsledek bude trochu víc zadrhávat ne¾ výsledek z Decomb. Typický skript je zde:</p>
<pre>B = TDeint(mode=1) # nebo KernelBob(order=1)
SmartDecimate(24, 60, B)</pre>
<p>
Aby byl zachován pøehrávaný výsledek co nejhlad¹í&nbsp;, provádí&nbsp;se
pøed tím odstranìní prokládání pomocí &nbsp;"Smart Bobb".</p>
<p>
<i>Pøevá¾nì video materiál (mode=1)</i></p>
<p>Kdy¾ je klip tvoøen pøevá¾nì video èástí chceme&nbsp;se 
vyhnout decimaci&nbsp;video èástí abychom&nbsp;zachovali co nejhlad¹í 
pøehrávání.&nbsp;U filmové èásti&nbsp;, chceme&nbsp;ponechat&nbsp;stejnou 
snímkovou frekvenci jako má video,&nbsp;ale&nbsp;zamìníme duplikované 
snímky&nbsp;smíchanými snímky,aby nebyly duplikáty viditelné. 
Nastavte&nbsp;Decimate&nbsp;na mode=        
      
    
      
    1,&nbsp;nebo 
TDecimate&nbsp;na hybrid=        
                
          3&nbsp;pro takové zpracování.</p>
<p>V tomto pøípadì smíte&nbsp;také zvá¾it jestli necháte&nbsp;klip prokládaný a tak
ho také zakódujete, obzvlá¹»&nbsp;kdy¾ ho budete pozdìji sledovat&nbsp;na TV.</p>
<h3>kódování do<a name="enc-120"></a>  &nbsp;cfr - 120 fps</h3>
<p>Budete pro to potøebovat&nbsp; <a href="http://bengal.missouri.edu/~kes25c/">TIVTC
a avi_tc</a>. Zaènìte vytvoøením&nbsp;<font color="#000000">    <A href="#create-vfr-mkv">decimovaného avi&nbsp;s timecodes.txt</A>, ale pøeskoète&nbsp;muxing. Pak otevøete&nbsp;</font>tc-gui's 
tc2cfr tab a pøidejte va¹e soubory nebo pou¾ijte&nbsp;tento pøíkazový øádek:</p>
<pre>tc2cfr 120000/1001 c:\video\video.avi c:\video\timecodes.txt c:\video\video-120.avi</pre>
<p>  Pak spojte 
(muxujte)&nbsp;s va¹ím&nbsp;audiem.&nbsp;To funguje proto¾e tc2cfr&nbsp;vytvoøí&nbsp;&nbsp;avi&nbsp;s vypu¹tìnými snímky&nbsp;vyplnìním zvlá¹tního prostoru&nbsp;vynechanými&nbsp;snímky&nbsp;pro vytvoøení hladkého&nbsp;avi se
120fps.</p>
<h3>kódování
do vfr (mkv)</h3>
<p>
Nejdøíve 
si stáhnìte&nbsp;
<a href="http://www.bunkus.org/videotools/mkvtoolnix/downloads.html">mkvtoolnix</a>. Pou¾ijete ho k&nbsp;muxování va¹eho&nbsp;videa&nbsp;do
MKV kontejneru&nbsp;s regulaèním souborem timecode. Pøesvìdète se, ¾e máte poslední verzi (1.6.0&nbsp;v dobì psaní
tohoto èlánku), proto¾e star¹í vydání èetly&nbsp;timecody nesprávnì.</p>
<p>
Je nìkolik&nbsp;pluginù pro&nbsp;AviSynth&nbsp;, které mù¾ete pou¾ít pro generování&nbsp;VFR
videa a po¾adování&nbsp;timecode souboru. Ní¾e je uveden pøíklad s pou¾itím pluginu&nbsp;
<a href="http://webpages.charter.net/falconx/decombvfrmod.html">Decomb521VFR</a> . Dal¹í alternativou je plugin&nbsp;TDecimate&nbsp;obsa¾ený v balíku&nbsp;
<a href="http://www.missouri.edu/~kes25c/">TITVC</a>&nbsp;. 
Podívejte 
se do jejich pøíslu¹né dokumentace, aby jste se dozvìdìli více o jejich&nbsp;nastavení.</p>
<p>Plugin&nbsp; <a href="http://avisynth.org/warpenterprises/">DeDup</a>&nbsp;odstraòuje&nbsp;duplikované snímky, ale nemìní snímkovou frekvenci (nechává&nbsp;trhavé video&nbsp;pokud není nejdøív decimované), tak¾e nemù¾e být zahrnutý. Stále mù¾e být pou¾it&nbsp;po&nbsp;jiné metodì s pou¾itím&nbsp;jejích timecodù jako vstupu pro
DeDup.</p>
<p>
<u> Decomb521VFR:</u></p>
<p>Pøidejte následující do va¹eho skriptu:</p>
<pre>Decomb521VFR_Telecide(order=1, guide=0)
Decomb521VFR_Decimate(mode=4, threshold=1.0, progress=true, timecodes=&quot;timecodes.txt&quot;, vfrstats=&quot;stats.txt&quot;)</pre>
<p>Otevøete tento skript ve VirtualDubu,
vytvoøí&nbsp;se&nbsp;timecody a statistické soubory pro kódování. Zpoèátku se bude zdát, ¾e zamrzne, proto¾e&nbsp;pøi prvním naètení
zkou¹í ka¾dý snímek.</p>
<p><i>TIVTC</i></p>
<p>Toto je&nbsp;2 prùchodový (2-pass) re¾im. Pøidejte do va¹eho skriptu toto:</p>
<pre>TFM(mode=1,output=&quot;tfm.txt&quot;)
TDecimate(mode=4,output=&quot;stats.txt&quot;)</pre>
<p>Otevøete a pøehrajte celé video ve VirtualDubu. Pak
ho zavøete, okomentujte&nbsp;tyto øádky&nbsp;(nebo spus»te druhý skript) a pøidejte:</p>
<pre>TFM(mode=1)
TDecimate(mode=5,hybrid=2,dupthresh=1.0,input=&quot;stats.txt&quot;,tfmin=&quot;tfm.txt&quot;,mkvout=&quot;timecodes.txt&quot;)</pre>
<p>Naètìte a zakódujte.</p>
<p><i>framerate</i></p>
<p>Pokud kódujete na zadanou velikost&nbsp;s pou¾itím&nbsp;bitrate kalkulátoru, vfr decimace zaneøádí&nbsp;kalkulaci. Aby znovu pracovala&nbsp;pøidejte do va¹eho
skriptu následující:</p>
<p>Pøed decimací:</p>
<pre>oldcount = framecount # tento øádek musí být pøed decimací
oldfps = framerate</pre>
<p> Konec skriptu:</p>
<pre>averagefps = (float(framecount)*float(oldfps))/float(oldcount)
AssumeFPS(averagefps)</pre>
<p>
<i>muxing</i></p>
<p>
Nyní
<a name="mkvmuxing" href="http://www.avisynth.org/VariableFrameRateVideo"></a>&nbsp;muxujte do&nbsp;MKV:</p>
<ol>
  <li> Otevøete&nbsp;mmg.exe (grafické prostøedí pro mkvmerge) 
  <li>Pøidejte vá¹&nbsp;soubor s video streamem 
  <li>Pøidejte vá¹&nbsp;soubor s audio streamem 
  <li>Kliknìte na importovanou video stopu 
  <li>    Vyhledejte soubor&nbsp;"timecodes.txt" 
  <li>Kliknìte na&nbsp;audio&nbsp;stopu 
  <li>Pokud va¹e&nbsp;audio u¾ potøebuje zpozdit, nastavte zpo¾dìní 
  <li>Spus»te muxování</li>
</ol>
<p>
Pro pøehrávání tohoto formátu potøebujete&nbsp;Matroska splitter.&nbsp;Pro AVC&nbsp;budete potøebovat&nbsp;
<a href="http://haali.cs.msu.ru/mkv/">Haali Splitter</a>, 
ale pro&nbsp;ASP mù¾ete pou¾ít&nbsp;
<a href="http://sourceforge.net/projects/guliverkli/">Gabestùv Splitter</a>.</p>
<h3><a name="create-vfr-mp4"></a>kódování do vfr (mp4)</h3>
<p>
Pokud vytvoøíte&nbsp;avi se&nbsp;120 fps&nbsp;s 
vypu¹tìnými snímky,&nbsp;tak&nbsp;muxované mp4 stejnì odstraní&nbsp;tyto snímky&nbsp;pøi kódování s jakýmikoliv n-vops&nbsp;vytvoøenými enkodérem a zùstane hybridní. Východiskem je&nbsp;kódovat
vícenásobné&nbsp;avi&nbsp;soubory (nìkteré s&nbsp;23.976 fps-film&nbsp;a&nbsp;nìkteré s &nbsp;29.97 fps-video) a spojit je&nbsp;pøímo do jednoho&nbsp;vfr mp4&nbsp;souboru&nbsp;pomocí mp4box a volbou&nbsp; -cat.</p>

<p>
Tøetí,&nbsp;mnohem jednodu¹¹í metodou je&nbsp;enkódovat&nbsp;pomocí metody MKV a pak video zpracovat&nbsp;pomocí tc2mp4:
více podrobností&nbsp;k tc2mp4&nbsp;najdete na&nbsp;[<a href="http://forum.doom9.org/showthread.php?t=112199/">Doom9
forums</a>].</p>

<h3>souhrn metod<a name="summary-methods"></a>   </h3>
<p>
Po shrnutí v¹ech výhod a nevýhod&nbsp;zmínìných 
metod,&nbsp;lze øíci
¾e&nbsp;pøi kódování do 23.976&nbsp;nebo 29.97 fps bude klip&nbsp;cfr (co¾ editory&nbsp;jako AviSynth a Virtualdub potøebují), ale
mù¾e to pøi pøehrávání vypadat trhanì kvùli duplikování nìkterých chybìjících snímkù. Tomu se lze vyhnout
smícháním, ale enkodéry pak nepracují tak dobøe. Pøi kódování do&nbsp;120 fps s pou¾itím vypu¹tìných snímkù, je
klip cfr, a nezadrhává pøi pøehrávání, a je velmi kompatibilní. Kódování do&nbsp;mkv s
pou¾itím&nbsp;true vfr (pou¾ití &nbsp;timecodes) neztrácí ani neduplikuje&nbsp;snímky, ale není tak&nbsp;roz¹íøené jako ¹iroce podporované&nbsp;AVI.</p>
<h2>Otevøení jiných hybribních videí ne¾<a name="reenc-vfr"></a>    &nbsp;MPEG-2 v&nbsp;AviSynthu a jejich pøekódování</h2>
<p>Je mo¾né otevøít v AviSynthu hybridní video i bez
ztráty&nbsp;synchronizace videa a zvuku: pou¾itím DirectShowSource. Nejbì¾nìj¹í formáty&nbsp;podporující hybridní video (vfr)&nbsp;jsou <b>mkv</b>,
<b>mp4</b>, <b>wmv</b>, a <b>rmvb</b>, a ní¾e
popsané metody pracují&nbsp;se v¹emi; nicménì pokud je zdroj&nbsp;mkv, mù¾ete také pou¾ít&nbsp; <font color="#ff0000"> <A href="#reenc-mkv2vfr">mkv2vfr</A></font>
 a AviSource.</p>
<h3>otevøení jiného ne¾-avi vfr&nbsp;obsahu v&nbsp;AviSynthu</h3>
<p>Nejlep¹í zpùsob jak dostat v¹echny snímky se zachováním 
synchronizace zvuku&nbsp;a èasováním&nbsp;je pøevést na bì¾nou snímkovou 
frekvenci, jako 120 fps&nbsp;pro 24/30 (nebo&nbsp;radìji 119.88). (V¾dy 
pou¾ijte&nbsp;convertfps=true,&nbsp;co¾ pøidává snímky jako&nbsp;ChangeFPS, 
jinak se va¹e audio <i>desynchronizuje</i>.<font color="#ff0000"></font></p>
<pre>DirectShowSource(&quot;F:\Hybrid\vfr.mp4&quot;, fps=119.88, convertfps=true)</pre>
<p>Mù¾ete to také otevøít jako 30p, co¾ musí být následnì
re-decimováno, ale týká se to málo snímkù,&nbsp;nebo 24p, poru¹ením&nbsp;30p sekcí:</p>
<p>
Pøekódování do&nbsp;23.976&nbsp;nebo 29.97 fps:</p>
<pre>DirectShowSource(&quot;F:\Hybrid\vfr.mkv&quot;, \
   fps=29.97, convertfps=true) # nebo fps=23.976</pre>
<p>
nebo</p>
<pre>DirectShowSource(&quot;F:\Hybrid\vfr_startrek.mkv&quot;, \
   fps=119.88, convertfps=true)
FDecimate(29.97) # nebo FDecimate(23.976)</pre>
<p>Dal¹ím zpùsobem je najít&nbsp;prùmìrnou snímkovou frekvenci (podìlením
celkového poètu snímkù&nbsp;délkou v sekundách) a pou¾ít tuto rychlost v&nbsp;DirectShowSource. V závislosti na
délce&nbsp;budou pøidávány&nbsp;nebo vypou¹tìny snímky&nbsp;pro zachování synchronizace, a to témìø zaruèuje zadrhávání.
DirectShowSource&nbsp;nebude provádìt telecine.</p>
<h3>pøekódování<a name="reenc-vfr-dss-non_mpeg2"></a> 120 fps videa</h3>
<p>Nejsnadnìj¹í cestou k pøevodu&nbsp;vfr zdrojù&nbsp;zpìt na vfr&nbsp;v AviSynthu&nbsp;je&nbsp;pou¾ití <a href="http://akuvian.org/src/avisynth/dedup/">DeDup</a>:</p>
<p>1. prùchod:</p>
<pre>DupMC(log=&quot;stats.txt&quot;)</pre>
<p>2. prùchod:</p><pre>DeDup(threshold=.1,maxcopies=4,maxdrops=4,dec=true,log=&quot;stats.txt&quot;,times=&quot;timecodes.txt&quot;)</pre>
<p>TIVTC to mù¾e udìlat také:</p>
<p>1. prùchod:</p>
<pre>TFM(mode=0,pp=0)
TDecimate(mode=4,output=&quot;stats.txt&quot;)</pre>
<p>2. prùchod:</p>
<pre>TFM(mode=0,pp=0)
TDecimate(mode=6,hybrid=2,input=&quot;stats.txt&quot;,mkvout=&quot;timecodes.txt&quot;)</pre>
<p>Jakmile zakódujete vá¹ soubor, muxujte ho zpátky&nbsp;do mkv&nbsp;nebo 120 fps avi.</p>
<p>Objeví se v¹echny duplikované 
snímky&nbsp;a&nbsp;vkládané directshowsource, pøi zachování&nbsp;poètu snímkù&nbsp;a&nbsp;velmi podobném èasování. Ale nepou¾ívá se stejný&nbsp;soubor timecode&nbsp;ze&nbsp; vstupního
videa, pou¾ije se nový. Tyto soubory nemusí&nbsp;být identické. (Samozøejmì si mù¾ete pohrát s parametry&nbsp;pokud chcete pou¾ít více funkcí&nbsp;dedup.)</p>
<h3>pøevod<a name="open-vfr-avi"></a>&nbsp;vfr&nbsp;do cfr avi&nbsp;pro AviSynth</h3>
<p>Mù¾ete se vyhnout&nbsp;analyzování a 
decimaci&nbsp;pou¾itím&nbsp;speciálních nástrojù&nbsp;pro dosa¾ení minimální konstantní-frekvence avi&nbsp;pro zásobení avisynthu. Po zpracování a pøekódování, pou¾ijte tc2cfr&nbsp;nebo mmg
na výstupu s originálními&nbsp;timecody&nbsp;pro opìtovné získání&nbsp;vfr a plné synchronizace. (Pokud provádíte&nbsp;nìjaký druh decimace nebo&nbsp;&nbsp;zmìnu
snímkové frekvence budete muset editovat vá¹&nbsp;timecode&nbsp;soubor sami, i kdy¾ má&nbsp;dedup&nbsp;timesin parametr.)</p>
<p><i>avi</i></p>
<p><a href="http://bengal.missouri.edu/~kes25c/">avi_tc</a> vytvoøí&nbsp; timecode a normální video, 
pokud&nbsp;avi&nbsp;pou¾ije vynechné snímky a
ne&nbsp;n-vop&nbsp;nebo&nbsp;plnì kódované snímky. To také vy¾aduje&nbsp;aby nebyly pøítomny ¾ádné audio nebo jiné dal¹í stopy. Pro jeho
pou¾ití&nbsp;otevøete&nbsp;tc-gui a pøidejte vá¹ soubor, nebo pou¾ijte následující pøíkazový øádek:</p>
<pre>cfr2tc c:\video\video-120.avi c:\video\video.avi c:\video\timecodes.txt 1</pre>
<p><i>mkv</i></p>
<p><a href="http://haali.cs.msu.ru/mkv/mkv2vfr.exe">mkv2vfr</a> extrahuje v¹echny&nbsp;video snímky&nbsp;z Matroska&nbsp;do normálního AVI souboru a timecodového
souboru. Funguje jen, kdy¾ je&nbsp;mkv&nbsp;ve vfw-re¾imu. Pøíkazový øádek pro pou¾ití mkv2vfr je:</p>
<pre>mkv2vfr.exe input.mkv output.avi timecodes.txt</pre>
<h3><font color="#000000">kódování do<a name="reenc-vfr-mpeg2"></a>  MPEG-2 vfr videa</font></h3>
<p>
http://forum.doom9.org/showthread.php?t=93691</p>
<p>
Je¹tì jsem se na to nepodíval, tak¾e nemohu komentovat/pøipomínkovat.</p>
<h2><a name="audio-sync"></a>Audio synchronizace</h2>
<p>
Po prohlédnutí v¹ech metod&nbsp;pro&nbsp;kódování Va¹eho 
hybridního videa&nbsp;(na 23.976, 29.97&nbsp;nebo vfr video) se mù¾ete ptát,
proè va¹e audio zùstane synchronní a&nbsp;pøitom nedotèené&nbsp;tìmito metodami, které pou¾ijete pro kódování va¹eho videa. Pøed
kódováním mají video a audio&nbsp;stejnou délku, tak¾e&nbsp;na poèátku jsou synchronní.&nbsp;Mohou nastat následující dvì
situace:</p>
<ul>
  <li>          
          zmìníte frekvenci snímkù&nbsp;streamu jejich urychlením&nbsp;nebo zpomalením 
  (jak je èasto dìláno pøi pøevodech&nbsp;PAL-FILM). To pøedpokládá, ¾e se zmìní délka video streamu, 
  a proto&nbsp;se desynchronizuje audio stream. 
  <li>            
      zmìníte frekvenci snímkù&nbsp;streamu pøidáním&nbsp;nebo odebráním snímkù. To <font color="#ff0000">pøedpokládá</font>, ¾e&nbsp;délka video
  streamu zùstane stejná, a proto&nbsp;audio stream bude synchronní.</li>
</ul>
<p>
Pokud kódujete video stream&nbsp;na 23.976&nbsp;nebo 
29.97 fps (oba&nbsp;cfr) s pou¾itím&nbsp;Decimate(mode=
     
   3, threshold=
        
  1.0)&nbsp;nebo Decimate(mode=1, threshold=  
        1.0), budou snímky pøidány nebo odstranìny, a proto&nbsp;vá¹
audio stream&nbsp;bude synchronní. Podle podobné úvahy&nbsp;bude vfr&nbsp;kódování také&nbsp;synchronní.</p>
<p>
Nakonec pøedpokládejme, ¾e otevøete&nbsp;vfr video&nbsp;v AviSynthu&nbsp;pomocí DirectShowSource.&nbsp;Srovnejte následující</p>
<pre>DirectShowSource(&quot;F:\Hybrid\vfr_startrek.mkv&quot;, \
   fps=29.97) # nebo fps=23.976</pre>
<p>
a</p>
<pre>DirectShowSource(&quot;F:\Hybrid\vfr_startrek.mkv&quot;, \
   fps=29.97, convertfps=true) # nebo fps=23.976</pre>
<p>V prvním pøípadì bude&nbsp;poru¹ena 
synchronizace&nbsp;od 24p sekcí, proto¾e je video urychleno,&nbsp;&nbsp;a v
druhém pøípadì bude synchronní, proto¾e jsou pøidány nebo odstranìny nìkteré snímky&nbsp;kvùli pøevodu na cfr.</p>

<p><b><u>Na 
dopracování:</u></b></p>
<ul>
  <li><a href="http://forums.animesuki.com/showthread.php?t=34738">http://forums.animesuki.com/showthread.php?t=34738</a>
 <a href="http://forum.doom9.org/showthread.php?t=112199">http://forum.doom9.org/showthread.php?t=112199</a> 
  tc2mp4, subs/Aegisub a ffmpegsource&nbsp;pro soubor timecode. 
  <li>sta¾ení&nbsp; <a href="http://fcchandler.home.comcast.net/WMVTIMES.exe" target="_blank">WMVTIMES.exe</a>. 
  <li>subs also: <a href="http://forum.doom9.org/showthread.php?t=135889&amp;page=2"> http://forum.doom9.org/showthread.php?t=135889&amp;page=2</a>. 

  <li>    jak urèit zda video (MP4)&nbsp;je vfr&nbsp;nebo není?: <a href="http://forum.doom9.org/showthread.php?t=137899"> http://forum.doom9.org/showthread.php?t=137899</a>. 
  <li><font color="#ff0000">      Wilbert: Nerozumím komentáøi
k
DeDup&nbsp;v "kódování do&nbsp;vfr (mkv)": potøebuje prozkoumat.</font>
  </li>
  <li><font color="#FF0000">MP4 and timecodes: dtsedit (open source) and
    tc2mp4Mod: <a href="http://forum.doom9.org/showthread.php?t=146840">http://forum.doom9.org/showthread.php?t=146840</a>
    http://zoome.jp/VFR_maniac/diary/6/</font>
  </li>
</ul>

<h2>Odkazy<a name="references"></a></h2>
<p>
Základní informace:
<a href="http://www.doom9.org/ivtc-tut.htm"> Force Film, IVTC, and Deinterlacing and more</a>
   (èlánek napsaný nìkterými lidmi na doom9).<br>
Tvorba&nbsp; <a href="http://www.masteryoshidino.com/hentai/anime-encoding.htm"> 120 fps video</a>.<br>
 Dokumentace <a href="http://webpages.charter.net/falconx/decombvfrmod.html">Decomb521VFR</a>.<br>
O pluginu&nbsp; <a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=80673"> Decomb521VFR1.0</a> modifikovaný pro automatizovaný&nbsp;Matroska VFR.<br>
<a href="http://forum.doom9.org/showthread.php?t=73819">Mkvextract GUI</a>&nbsp;od DarkDudae.
<p>
<i>      Kromì v¹ech lidí, kteøí se podíleli
na zde zmínìných nástrojích, by chtìl autor tohoto návodu&nbsp;(Wilbert)&nbsp;podìkovat tìmto: bond, manono,
tritical a foxyshadis - za jejich u¾iteèné&nbsp;návrhy a pøipomínky k tomuto návodu.</i>
<p>
<kbd>$English Date: 2009/07/12 12:49:59 $</kbd></p>
<P><KBD>Èeský pøeklad:18.9.2009</KBD></P>
<FORM><INPUT TYPE="button" VALUE="Zpìt"
 onClick="history.go(-1)"></FORM>
</BODY>
</HTML>


