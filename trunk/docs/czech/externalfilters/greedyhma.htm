<html>
<head>
<title>GreedyHMA</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: greedyhma.htm,v 1.1 2010/02/27 14:50:14 wilbertd Exp $ 
-->
</head>
<body>
<h1>GreedyHMA</h1>
<h2>Pøehled</h2>
<b>autor:</b>  Tom Barry
<br><b>verze:</b>    0.4.1.0<br>
<b>stáhnout:</b> <a href="http://www6.impacthosting.com/trbarry/downloads.htm">http://www6.impacthosting.com/trbarry/downloads.htm</a>, 
<a href="http://www.avisynth.org/warpenterprises/">http://www.avisynth.org/warpenterprises/</a>
<br><b>kategorie:</b>  Odstraòování prokládání &amp; pulldown
<br><b>požadavky:</b>  &nbsp;
<ul>
  <li>  YUY2 Barevné prostøedí</li>
  <li>SSEMMX podpora</li>
</ul>

<hr size=2 width="100%" align=center>

<h2>Popis</h2>

<p>Poznámka - Tato verze je pro Avisynth 2.5 (jen YUY2). Pro AviSynth 2.0x použijte dll ve složce "Older".<br>
<br>
        GreedyHMA - Greedy (High Motion for Avisynth)<br>
<br>
        GreedyHMA.dll je Avisynth filtr, který vykonává algoritmus kódu Greedy/HM z DScaleru
pro provádìní uspoøádání pulldown, filtrování, a odstranìní prokládání z videa.<br>
<br>
        Prostì rozbalte obsah do Avisynth složky, nebo nìkam jinam. Jak je vidìt ze skriptu,
vytvoøil jsem podsložku pod Avisynthem, pro jeho oddìlené uložení.<br>
<br>
        Následující je Bikes.avs, jeden ze skriptù, které jsem testoval:</p>

<pre>LoadPlugin(&quot;d:\AVISynth\GreedyHMA\Debug\GreedyHMA.dll&quot;)
clip = AviSource(&quot;c:\vcr\bikes.avi&quot;)
return clip.GreedyHMA(1,0,4,0,0,0,0,0)</pre>

<p>Zadává soubor (zmìòte na váš) a žádá zapnout horní pole první (TopFirst) a AutoPulldown, 
s decimací (vypouštìním snímkù) na 24 fps.  Dosud jsem ho testoval jen s Avisynth/VirtualDub.&nbsp;</p>

<h3>Upozornìní</h3>

<p>Døíve, do V 0.4.0.0 jsem každému øíkal, že TopFirst témìø vždy pracuje lépe, ale
to se ukázalo, že je kvùli chybì v kódu BottomFirst GreedyHMA. Takže by jste si zde mìli
ovìøit jakýkoli pøedchozí test. Nìkteøí lidé kvùli tomu dostávali zbyteèné roztøepení nebo
artefakty prokládání.</p>

<p>V nìkterých zdrojích jsem dostal mírnì lepší výsledky s TopFirst (øeknìme HDTV nahrávky), ale jiné
jsou lepší když je to vypnuto. Všímám si, že je možné spustit 2 kopie Vdubu a dìlat porovnání snímek po snímku.
Nezdá se, že je tam velký rozdíl, ale stálé srovnávání dvou snímkù (dívejte se na 
úhlopøíèky) obvykle zobrazí jeden jako lepší. Mùžete se na to prostì podívat ve vstupech VirtualDubu.
Opravdu není nutné vytváøet jakékoliv soubory.</p>

<p>Pro verzi 0.4.0.0 jsem pøidal dva nové skriptové filtry do zipu, aby jste mohli s jistotou øíci jestli by jste mìli použít TopFirst. 
Upravte skript BottomFirst.avs aby ukazoval na váš soubor a naètìte ho
do VirtualDubu. Pak krokujte po nìkolika jednotlivých snímcích. Ignorujte chvìní nahoru a dolù o jeden øádek, 
ale sledujte jestli uvidíte, že každý snímek jde pozpátku. Pokud ano, pravdìpodobnì potøebujete TopFirst.
Zkuste skript TopFirst.avs , aby jste si to potvrdili. Ani jeden z tìchto dvou skriptù nezávisí na GreedyHMA.</p>

<p>Po nalezení správného nastavení TopFirst (T=0 nebo 1) aplikujte následující pokyny,
dosazením TopFirst za 'T'.</p>

<p>Pokud si myslíte, že máte pøevážnì filmový zdroj, nebo DVD2AVI to øíká, tak použijte:</p>

<pre>GreedyHMA(T,0,5,0,0,0,0,0) # což je vynucení Film+Decimace na 24 fps.</pre>

<p>Pokud máte samé video, použijte:</p>

<pre>GreedyHMA(T,0,0,0,0,0,0,0) # pro 30 FPS výstup (25 FPS PAL), nebo
GreedyHMA(T,0,3,0,0,0,0,0) # pro 24 FPS výstup</pre>

<p>a když nevíte, nezáleží vám na tom, nebo je to všechno promíchané, proveïte to automaticky:</p>

<pre>GreedyHMA(T,0,4,0,0,0,0,0) # pro všechny úèely nejvíce automatické nastavení (NTSC), nebo
GreedyHMA(T,0,1,0,0,0,0,0) # pro všechny úèely nejvíce automatické nastavení (PAL)</pre>

<p>Další úpravy lze pøidat následujícími parametry:</p>

<h3>GreedyHMA Seznam parametrù</h3>

<p><code>GreedyHMA</code> (<var>clip, TopFirst, SwapFields, AutoPullDown,
&quot;MedianFilter&quot;, &quot;VerticalFilter&quot;, &quot;EdgeEnhance&quot;,
&quot;GoodPullDownLvl&quot;, &quot;BadPullDownLvl&quot;</var>)</p>

<p>Všechny hodnoty jsou celoèíselné, 0=ne, 1=ano:</p>

<p><var>TopFirst</var> - pøedpokládá, že horní pole, øádky 0,2,4,... by mìla být zobrazena první.
Výchozí je pravdìpodobnì bìžnìjší BottomFirst, ale na ATSC nahrávkách z mé WinTV-HD karty pracuje TopFirst stále lépe.</p>

<p><var>SwapFields</var> - pro porouchané zachytávací ovladaèe, které vkládají øádky 1,3,5.. nad øádky 0,2,4...</p>

<p><var>AutoPullDown</var> - Nastavuje jaký typ zpracování pulldown je vyžadovaný. Platné hodnoty parametru jsou:</p>

<p>0 - Žádný pulldown, prosté odstranìní prokládání (vynutit video). Nevypouští žádné
snímky, takže FPS je ponechána na 30 FPS, nebo jiných. Neprovádí decimaci<br>
                (pentimate?). Použijte pokud máte (a chcete) 30 fps video zdroj a možná 25 FPS PAL video.</p>

<p>1 - Auto Pulldown. Automaticky rozhoduje, které snímky by mìly být podrobeny IVTC nebo odstranìní prokládání, podle nastavení Good a Bad
Pulldown Lvls (viz níže). Nedecimuje. Toto je nejlepší, pokud máte smíchaný film a video a nechcete 30 fps výstup. Také lepší pro
PAL zdroje.</p>

<p>2 - Jen Pulldown (Vynutit Film). Pøedpokládá filmový zdroj, vždy provádí IVTC a
nikdy neodstraòuje prokládání. Nedecimuje. Použijte pro PAL filmové zdroje.</p>

<p>Hodnoty 3-5 odpovídají tìm výše uvedeným, ale s vypuštìním snímkù (Decimací, pentimation?)
Je prohlédnuto pìt snímkù v èase a ten, který se nejvíc zdá být duplikovaný je vypuštìn, takže se sníží FPS , øeknìme, z 30 na 24.</p>

<p>3 - Odstranit prokládání (Vynutit Video), ale s vypouštìním snímkù. Použijte pro NTSC video
pokud pøesto chcete decimovat. U video zdroje ve skuteènosti nejsou vhodná pole pro vypuštìní, ale toto vypustí ty, které vypadají nejvíce jako
duplikované.</p>

<p>4 - Auto Pulldown s vypouštìním snímkù. Nejlepší (nejvíce automatické) nastavení.
Pracuje ve vìtšinì pøípadù, alespoò pokud odstraním všechny chyby.</p>

<p>5 - Jen Pulldown (Vynutit Film) s vypouštìním snímkù. To dá nejlepší
výsledky pokud máte 100% správnì zpracovaný NTSC filmový zdroj bez video èástí a bez velkého poètu støihù. Mùže se pøizpùsobit vìtšinì zmìnám scén a zmìnám v kadenci pulldown, ale ne smíchaným polím.</p>

<p>Nepokoušel jsem se dívat co je z tohoto nejlepší. Pulldown nepracuje ještì
perfektnì. Ale pokud si nejste jisti, mùžete èasto pøejít na 4 (Auto). Mìlo by správnì zpracovat sporty s velkým pohybem. 
Pokud se pøepne do režimu prokládání pøíliš èasto pøi zpracování filmu, mùžete zkusit trochu zvyšovat
Bad Pulldown Level.</p>

<p>***** POZNÁMKA!  MEDIAN FILTER JE V TOMTO VYDÁNÍ VYPNUT. *****</p>

<p><var>MedianFilter</var> (èasový - temporal) - pomáhá vyèistit šum pokud je to potøeba, ale zpùsobuje	zpoždìní o        
2 pole. (Jinak je zpoždìní o 1 pole). Zadáním 1
se zapne použití výchozích 3 (lze zmìnit) ale mùžete také            
zadat 2-255 pro pøepsání tohoto nastavení. Ale hodnoty pøes asi 3-5 mohou zpùsobit pohybové
artefakty ve videu s rychlým pohybem.</p>

<p>Viz poznámku výše. Vyøadil jsem Median Filter pøidáním vypouštìní snímkù tím, že bìží
se zpoždìním 2 místo èehokoli jiného. To se zdálo ménì dùležité, takže jsem ho pro zatím vypnul. Parametr je v souèasnosti ignorován.</p>

<p>Median Filter je nepotøebná komplikace zatímco GreedyHMA je nový, protože
mìní vnitøní logiku èasování, a tím mate testování nìkterých èástí specifického Avisynth kódu. Znovu ho zapnu, jakmile bude všechno ostatní pevné, ale
prozatím je stále vypnut.</p>

<p>***** POZNÁMKA *****</p>

<p><var>VerticalFilter</var> - Nejen pomáhá snížit šum, ale také nìkteré artefakty odstraòování prokládání
protože je vykonáván jako poslední, po odstranìní prokládání. Užiteèný pokud chcete zmenšovat. Použijte jen hodnoty 0,1.  Také to pomáhá kompresi.</p>

<p><var>EdgeEnhance</var> (horizontální) - Pøidává malé zostøení pro plné rozlišení videa. Toto mùže  	        
také použít hodnot 2-100. Výchozí je v souèasnosti 50, jestliže je zadáno 1.
V budoucnu mohu také podporovat záporné hodnoty, pøetvoøením na horizontální filtr pro zlepšení nastavení pro zmenšování.</p>

<p><var>Good Pulldown Lvl</var> - Toto je èíslo mezi 1-255 , které musí být pøekroèeno než
GreedyHMA provede pulldown pro snímek. Tento parametr je ctìn jen když je také zapnuto Auto Pulldown (AP=1 nebo 4). Výchozí je možné zmìnit, ale je
v souèasnosti nastaveno na 90. Ale výchozí hodnotu získáte zadáním 0, což je doporuèeno pro vìtšinu pøípadù. Je to ve skuteènosti jen prùmìr 
ukládaných souèinitelù pomìru comb/weave nìkolika snímkù jejich správným uspoøádáním.</p>

<p><var>Bad Pulldown Lvl</var> - Toto je èíslo mezi 1-255 , které NESMÍ být pøekroèeno než
GreedyHMA provede pulldown pro snímek. Tento parametr je ctìn jen když je také zapnuto Auto Pulldown (AP=1 nebo 4). Výchozí je možné zmìnit, ale je
v souèasnosti nastaveno na 85. Ale výchozí hodnotu získáte zadáním 0, což je doporuèeno pro vìtšinu pøípadù. Je to ve skuteènosti jen míra toho
jak špatnì by byly souèinitele comb/weave zvyšovány, kdyby jsme provedli èisté uspoøádání snímkù.</p>

<p>Novì ve V 0.4.0.0 když je pøi Force Film zadáno (AP=2,5) Bad Pulldown level,
vychází hodnoty nemožnì velké. Ale to mùže být pøepsáno na stálé odstraòování prokládání ve snímcích s extrémními artefakty prokládání.
Nezkoušel jsem najít optimální hodnotu, ale je pravdìpodobnì menší než 150. Zadání 0 dá výchozí vždy Force Film.</p>

<p>Prozatím musí být pøítomno všech 8 parametrù, není to kontrolováno chybou, a ani dokumentací kromì
o Greedy/HM na <a href="http://www.dscaler.org"> www.dscaler.org</a></p>

<h3>Známé problémy a omezení</h3>

<p>1) 	TOTO JE JEN PRO SSE STROJE!</p>

<p>Toto je napsáno jako pokroèilá možnost DScaler Greedy/HM, èásteènì v assembleru jen pro
SSE stroje.  Až dosud nemám žádnou chybovou kontrolu, takže prostì SPADNE, pokud
nemáte alespoò rychlejší Celeron, P-III, Athlon, nebo vyšší. Nejsem si jistý jestli toto
bude v budoucnu opraveno, ale mohl bych pokud to èas dovolí.</p>

<p>2) 	V souèasnosti žádné chybové kontroly ani zprávy. Zatím jsem neøešil jak na zprávy o problémech
v Avisynthu, a je hromada vìcí, které bych mìl kontrolovat.</p>

<p>3) 	Pøedpokládá se YUV (YUY2) na snímcích založený vstup. Použijte pøed tím AVIsynth funkci pøo pøevod pokud je potøeba.</p>

<p>4)	V souèasnosti omezeno na rozlišení snímku 1928x1088 pixelù.</p>

<p>5)  Opraveno</p>

<p>6)	Existuje zvláštní chyba, které vùbec nerozumím. Pokud pøidáte nový nebo zmìnìný
GreedyHMA.dll do vašeho poèítaèe, a poprvé rozbìhnete VirtualDub/Avisynth/GreedyHMA,
tak VirtualDub se mùže zastavit. Pokud pak použijete správce úloh pro pøerušení VirtualDubu, bìží i potom.  
Taková èinnost se zdá být pøi prvním otevøení jakéhokoli
jiného AVI souboru ve VirtualDubu, poprvé nastane po instalaci GreedyHMA,
pøed otevøením Avisynth skriptù. Pozdìjší poznámka: nezávisí to vùbec na GreedyHMA, 
stává se to na mém stroji, Ale já tomu stále nerozumím.</p>

<p>7)  V souèasnosti pracuje správnì, jen když je šíøka obrazu v pixelech dìlitelná 16.
Jinak mùže vytváøet smetí v pravé èásti obrazu, které budete možná muset oøíznout.</p>

<p>8)  Jak je uvedeno výše, možnost Median Filter je doèasnì ignorována.<br>
</p>

<p>
        Posílejte prosím komentáøe Tomu Barrymu (trbarry at trbarry.com)</p>

<p><kbd>$English Date: 2004/08/13 21:57:25 $</kbd></p>
<p><kbd>Èeský pøeklad:4.5.2009</kbd></p>
</body>
</html>
