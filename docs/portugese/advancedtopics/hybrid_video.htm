<html>
<head>
<title>UnComb</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: hybrid_video.htm,v 1.1 2006/03/26 18:11:19 wilbertd Exp $ 
-->
</head>
<body>
<h1>AviSynth, vídeo de framerate variável (vfr) e vídeo híbrido</h1>
<p><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Microsoft Sans Serif'; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">Há
dois tipos de vídeo ao se considerar “framerate”. vídeo de Framerate
constante (vfc) e de framerate variável (vfv). Para vídeo vfc os quadros têm
uma duração constante e para vídeo vfv, têm uma duração inconstante.
Muitos programas de edição (inclusive VirtualDub e AviSynth) assumem que o vídeo
tem vfc. Um das razões é que o avi não suporta vfv. Isto não mudará num
futuro próximo por várias razões. Embora o recipiente do avi não suporta
vfv, há vários recipientes (mkv, mp4 e wmv por exemplo) que suportam.&nbsp;</span>
<h2>Framerate variável e vídeo híbrido</h2>
<p><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Microsoft Sans Serif'; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">É
importante entender que no vídeo em geral é essencial vfc (pelo menos em
captura de vídeo ou ripagem de dvds). Há uma exceção onde a conversão para
vfv é muito útil, que é o vídeo híbrido. O vídeo híbrido consiste em
partes que são entrelaçado/progressivo NTSC (29.97 fps) e FILME (que é
telecinado a 29.97 fps). Ao ser tocado o vídeo híbrido, a parte NTSC (também
chamada parte de vídeo) é tocada a 29.97 fps e a parte telecinada a 23.976
fps.&nbsp; Exemplos de vídeo híbrido são alguns <i>animes</i> e materiais de
Jornada nas Estrelas.</span>
<h2>Codificando vídeo híbrido (fps = frames per second - quadros por segundo)</h2>
<p><span style="FONT-SIZE: 10pt; FONT-FAMILY: 'Microsoft Sans Serif'; mso-bidi-font-size: 12.0pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: PT-BR; mso-fareast-language: PT-BR; mso-bidi-language: AR-SA">O
assumindo que o vídeo é híbrido, há vários modos para codificá-lo. Eles são
listados abaixo. <span style="mso-spacerun: yes">&nbsp;</span>O primeiro está
convertendo a vídeo de vfc (ou 23.976 ou 29.97 fps), o segundo está
codificando a 120 fps usando avi e perda de quadros (onde os quadros duplicados
são perdidos no playback). O último está criando o verdadeiro vfv com o
recipiente mkv.</span>
<h3>codificando para 23.976 fps ou 29.97 fps</h3>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se escolhermos a taxa de vídeo, as seqüências
de vídeos estarão OK, mas as seqüências de FILME não serão dizimadas,
parecendo saltar (devido aos quadros duplicados). Por outro lado, se nós
escolhermos a taxa de FILME, as seqüências do FILME serão OK, mas as seqüências
de vídeos serão dizimadas, parecendo saltar (devido à &quot;perda de
quadros&quot;).</span> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Adicionalmente, você terá mais baixa qualidade
pelo mesmo tamanho de arquivo, por causa de 25% a mais no número de quadros? É
difícil decidir qual escolher. Se o clipe é principalmente FILME você pode
escolher 23.976 fps e se o clipe é principalmente vídeo, pode escolher 29.97
fps. Se você cria seu arquivo de projeto d2v, verá se o clipe é
principalmente vídeo (NTSC) ou FILME (na caixa de informação).</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O plugin Decomb do AviSynth provê dois modos
especiais de dizimação para controlar melhor os clipes híbridos. Para citar a
documentação de Decomb como usar este plugin:</span></p>
<p><i><span style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Principalmente Clipes de Filme (mode=3)</span></i></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Vamos primeiro considerar o caso em que o clipe
é principalmente filme. Neste caso, nós queremos dizimar as porções do filme
normalmente para que eles se tornem suaves. Para as porções não de filme,
queremos reduzir a sua taxa de quadro por mistura de dizimação em cada ciclo
de quadros, de 5 quadros para 4 quadros. As seqüências de vídeos assim feitas
parecem mais suaves que as dizimadas como filme.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Aqui, um escrito típico para habilitar este modo
de operação:</span></p>
<pre>Telecide(order=0, guide=1)
Decimate(mode=3, threshold=1.0)</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Há 2 fatores que habilitam Decimate a tratar
adequadamente as porções do filme e de não filme. Primeiro, quando Telecide
declarar guide=1, pode passar a informação para Decimate sobre quais quadros são
derivados de filme e para os de vídeo.</span> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Para este mecanismo trabalhar, Decimate tem que
imediatamente seguir Telecide. Claramente, quanto melhor o trabalho que você
faz com padrão que fecha em Telecide (dando os parâmetros como exigido), tanto
melhor trabalho Decimate pode fazer.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O segundo fator é o percentual. Se um ciclo de
quadros é visto e não tem uma duplicata, então o ciclo é tratado como vídeo.
O percentual determina qual porcentagem de diferença de quadro é considerada
uma duplicata. Note que threshold=0 desativa o segundo fator.</span></p>
<p><i><span style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Principalmente Clipes de </span>Vídeo (mode=1)</i></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Vamos agora considerar o caso em que o clipe é
principalmente vídeo. Neste caso, não queremos dizimar as porções de vídeos
suaves. Para as porções de filme, queremos deixar na taxa de vídeo e mudar o
quadro duplicado em uma mistura de quadro, assim não é tão óbvio.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Aqui está um escrito típico para habilitar este
modo de operação:</span></p>
<pre>Telecide(order=0, guide=1)
Decimate(mode=1, threshold=1.0)</pre>
<h3>codificando para 120 fps usando avi com duplos quadros</h3>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Você precisa das <a href="http://www.masteryoshidino.com/hentai/anime-encoding.htm">seguintes
utilidades</a></span></p>
<ul>
  <li>Avi60 e GUI
  <li>Dec60.dll (para AviSynth legado 2.0x)
  <li>FPSCheck
  <li>AviSynth legado versão 2.0x (NÃO 2.5)
  <li>DecombLegacy.dll (para AviSynth legado 2.0x)
  <li>DVD2AVI versão 1.76
  <li>MPEG2DEC.dll (para AviSynth v2.0x; exigido para FPSChk.exe)</li>
</ul>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O linque acima descreve como fazer isto
perfeitamente. Mas já que se pode fazer um pouco mais simples, repetiremos o
processo aqui:</span></p>
<p>1) <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Crie o arquivo índice (idx):</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Ponha DVD2AVI 1.76 e MPEG2DEC.dll no mesmo diretório
onde FPSChk.exe fica situado, senão entra em CHOQUE. Inicie o FPSChk.exe.
Infelizmente é japonês, mas nós o guiaremos:<span style="mso-spacerun: yes">&nbsp;
</span>Use ALT+F, e tecle O para abrir um arquivo. Abra seu arquivo D2V e então
você pode vê-lo.</span> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O próximo passo é usar as teclas ALT+A e
apertar S para esquadrinhar o D2V para porções de FILME e as que são VÍDEOS.
Os contadores na barra de estado embaixo contarão para baixo, assim seja
paciente e espere. Quando o esquadrinhando terminar, tecle ALT+F e depois W para
gravar o arquivo IDX.</span></p>
<p>2) <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Codifique a um arquivo 30 fps usando dec60.dll:</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Aqui você pode usar AviSynth v2.5 novamente (mas
também precisa de mpeg2dec.dll e dvd2avi 1.76). E precisa do LoadPluginEx.dll
para carregar os plugins de v2.0x. Crie o escrito seguinte (não esqueça de
ajustar os caminhos)</span></p>
<pre>LoadPlugin(&quot;C:\Program Files\AviSynth2_temp\plugins\LoadPluginEx.dll&quot;)
LoadPlugin(&quot;C:\Program Files\AviSynth2_temp\Dec60.dll&quot;)
LoadPlugin(&quot;C:\Program Files\AviSynth2_temp\mpeg2dec.dll&quot;)

Mpeg2Source(&quot;F:\Guides\Hybrid\TNGsample.d2v&quot;)
Dec60(idxfile=&quot;F:\Guides\Hybrid\TNGsample.idx&quot;, deint=false)</pre>
<p>Crie o DivX/XviD.</p>
<p>3) <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Converta arquivo crappy 29.97 fps a 119.88 fps:</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Agora execute AVI60GUI.exe e vai notar três
campos. O topo é onde você carrega seu avi codificado pelo passo DEC60. O
segundo campo pede onde você deseja salvar o avi modificado. O campo ao fundo
pede seu arquivo IDX. Uma vez que todos os três estejam carregados e o campo de
119.88 fps está destacado, tecle Enter e espere. Uma vez feito, um vídeo de
120 fps suave e sedoso foi codificado. Agora é a vez de muxar o seu áudio.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Isto trabalha porque os quadros atuais feitos são
29.97 fps, mas cortados de tal modo que 23.976 fps e 29.97 fps são dados a uma
taxa diferente de playback por perda de quadros (que atrasa os quadros ao tempo
correto de ms). (Se você abrir o avi no VirtualDub verá quais quadros serão
perdidos no playback (abaixo do quadro verá: quadro 23 (0:00:00.192) [<b>D</b>]
[43.91 kB]).</span></p>
<h3>criando vídeo vfv com o recipiente mkv (matroska)</h3>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Pegue o plugin Decomb modificado chamado <a href="http://webpages.charter.net/falconx/decombvfrmod.html">Decomb521VFR</a>
que pode gravar um arquivo de timecodes e vfvstats. O anterior informa quais
quadros são tais taxas de quadro. Faça o escrito seguinte</span></p>
<pre>Mpeg2Source(&quot;F:\Guides\Hybrid\TNGsample.d2v&quot;)
Decomb521VFR_Decimate(mode=4, threshold=1.0, progress=true, timecodes=&quot;F:\Guides\Hybrid\timecodes.txt&quot;, vfvstats=&quot;F:\Guides\Hybrid\video.vfvstats&quot;)
# veja a documentação Decomb521VFR para detalhes</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Abra este escrito no VDub ou VDubMod e toque. Serão
criados os timecodes e os arquivos vfvstats. A seguir remova a linha Decomb521 e
salve o escrito seguinte</span></p>
<pre>Mpeg2Source(&quot;F:\Guides\Hybrid\TNGsample.d2v&quot;)</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">e codifique-o para DivX/XviD (a 29.97 fps).</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Abra o <a href="http://www.bunkus.org/videotools/mkvtoolnix/downloads.html">mmg.exe
que é um gui para mkvmerge</a>: abra o vídeo, o áudio, os arquivos
timecodes.txt (que é possível se você clicar no vídeo clipe) e inicie o
muxar.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Para tocar, você precisa de um splitter
(divisor) Matroska que você pode pegar aqui (<a href="http://sourceforge.net/projects/guliverkli/">Gabest</a>)
ou aqui (<a href="http://haali.cs.msu.ru/mkv/">Haali</a>).</span></p>
<h3>resumo dos métodos</h3>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Resumindo as vantagens e desvantagens dos métodos
acima mencionados. Ao codificar para 23.976 ou 29.97 fps o clipe será vfc (que
é bom se quer re-editar no AviSynth/VDub, porque muitos editores precisam de
material vfc), mas parecerá saltar no playback devido aos quadros duplicados ou
perdidos.</span> <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Ao codificar a 120 fps com perda de quadros, o
clipe é vfc e não pula no playback. Porém é muito esforço para criar essas
codificações de 120 fps (e algumas das ferramentas exigidas são fonte
fechadas). Codificando com o mkv que usa o verdadeiro vfv (com timecodes) é a
única opção que não tem desvantagem (diferente do mkv que não é suportado
em tocadores de mesa).</span></p>
<h2>Abrindo vídeo vfv (vídeo híbrido) no AviSynth</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Para abrir seu vídeo vfv no AviSynth sem perda
de sincronismo, ele deve primeiro ser convertido em vfc. Isto pode ser feito de
dois modos: com <font color="#660033">mk2vfr</font> (com a habilidade de extrair
arquivos timecodes e habilitando o reencode para mkv) ou DirectShowSource.</span>
<p><b>1) Usando mkv2vfr:</b>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA"><font color="#660033">mkv2vfr</font> extrai todos
os quadros de vídeos do Matroska para um arquivo vfc AVI e um arquivo de
timecode. Você pode extrair o vídeo em avi, reprocessá-lo com qualquer
aplicativo e muxar para Matroska com um arquivo de timecode. Assumindo que não
foram incluídos/removidos quadros, pode usar o mesmo arquivo timecode e se você
mudou o número de quadros, precisa editar o arquivo timecode à mão. <font color="#660033">mkv2vfr</font>
é uma aplicação de linha de comando. Uso</span>
<p>mkv2vfr.exe xvid.mkv xvid.avi timecodes.txt
<p><a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=89294&amp;highlight=mkv2vfr">http://forum.doom9.org/showthread.php?s=&amp;threadid=89294&amp;highlight=mkv2vfr</a>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Abra o avi no AviSynth (23.976 ou 29.97 fps; veja
o arquivo timecode):</span>
<pre>AviSource(&quot;xvid.avi&quot;)</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:red;mso-ansi-language:PT-BR;
mso-fareast-language:PT-BR;mso-bidi-language:AR-SA">Mas, a utilidade trabalha
corretamente?</span>
<p><b>2) <span style="font-size:10.0pt;mso-bidi-font-size:
12.0pt;font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Usando DirectShowSource (mas ainda não é possível
ter o arquivo timecode; assim acho que não é possível recodificar para
mkv-vfr):</span></b>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Recodificando para 23.976 ou 29.97 fps:</span>
<pre>DirectShowSource(&quot;F:\Guides\Hybrid\vfv_startrek.mkv&quot;, fps=29.97, convertfps=true) # ou fps=23.976</pre>
<p>ou</p>
<pre>DirectShowSource(&quot;F:\Guides\Hybrid\vfv_startrek.mkv&quot;, fps=119.88, convertfps=true)
FDecimate(29.97) # ou FDecimate(23.976)</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">(Teoricamente, não sei o que produz melhores
resultados). Isto também trabalha para MP4.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se você o abre como fps=29.97 e restaura o
arquivo timecode com decomb521vfr, algo dá errado por alguma razão.</span></p>
<h2>Criando e abrindo vídeo vfv (MKV/MP4) no AviSynth</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Eu penso ser seguro dizer que mkv de vfv são
sempre híbridos (no momento não há nenhuma ferramenta para criar arquivos
&quot;verdadeiro&quot; mkv de vfv). Se você tem um arquivo mp4 de vfv não
precisa passá-lo a híbrido. Para criá-los: Aqui você pode encontrar como
fazer AVIs com <a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=93263&amp;perpage=20&amp;pagenumber=2">n-vops</a>.
Ao transcodificar AVI para MP4 (<a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=73633">MP4box
ou com muxer 3ivx mp4</a>) para criar um verdadeiro fluxo MP4 vfv (os quadros
n-vop são removidos).</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Como você sabe se o mkv/mp4 é vfv (sem ter o
avi original)?</span></p>
<ul>
  <li><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">mkv: pega o arquivo timecode usando mkv2vfr para
    verificar isso.</span>
  <li>mp4: <span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;color:red;mso-ansi-language:PT-BR;
mso-fareast-language:PT-BR;mso-bidi-language:AR-SA">Eu não sei (para confirmar
    se um mp4 é vfv, você pode abri-lo no mp4ui e confirmar o framerate
    informado).</span></li>
</ul>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">GSpot pode ser usado para conferir se o AVI tem
quadros n-vops (clipe btw com n-vops ainda é vfc.).</span>&nbsp;</p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Um dos modos para abrir estes arquivos vfv (não-híbridos)
em AviSynth, é encontrar o framerate médio e usar essa taxa no
DirectShowSource. Assim</span></p>
<pre>av_rate = ...
DirectShowSource(&quot;F:\Guides\Hybrid\vfv.mp4&quot;, fps=av_rate, convertfps=true)</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Dependendo da duração de um quadro, os quadros
serão acrescentados ou removidos para manter a sincronia.</span></p>
<h2>Sincronização de áudio</h2>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">São discutidos vários métodos para codificar
seu vídeo (a 23.976, 29.97 ou vídeo vfv). Você pode saber por que o áudio
permanece em sincronia sem se preocupar com qual método codificar o vídeo.
Antes de codificar, o vídeo e áudio têm a mesma duração desde que estejam
em sincronia. As seguintes situações podem acontecer:</span></p>
<ul>
  <li><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">você muda o framerate de seu o fluxo
    acelerando-o ou reduzindo sua velocidade (como é freqüentemente feito por
    conversões de FILME PAL). Isto implica que a duração do vídeo mudará e
    conseqüentemente o áudio estará fora de sincronia.</span>
  <li><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">você muda o framerate do seu fluxo acrescentando
    ou removendo quadros. Isto implica que a duração do vídeo permanecerá o
    mesmo e conseqüentemente o áudio estará em sincronia.</span></li>
</ul>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Se você codifica o vídeo para 23.976 ou 29.97
fps (ambos vfc) usando Decimate(mode=3, threshold=1.0) ou Decimate(mode=1,
threshold=1.0), os quadros serão removidos ou acrescentados e assim seu áudio
estará em sincronia. Por razão semelhante a codificação vfv estará em
sincronia.</span></p>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">Finalmente, suponha abrir o vídeo vfv no
AviSynth com DirectShowSource. Compare o seguinte:</span></p>
<pre>DirectShowSource(&quot;F:\Guides\Hybrid\vfr_startrek.mkv&quot;, fps=29.97) # ou fps=23.976</pre>
<p>e</p>
<pre>DirectShowSource(&quot;F:\Guides\Hybrid\vfr_startrek.mkv&quot;, fps=29.97, convertfps=true) # ou fps=23.976</pre>
<p><span style="font-size:10.0pt;mso-bidi-font-size:12.0pt;
font-family:&quot;Microsoft Sans Serif&quot;;mso-fareast-font-family:&quot;Times New Roman&quot;;
mso-bidi-font-family:&quot;Times New Roman&quot;;mso-ansi-language:PT-BR;mso-fareast-language:
PT-BR;mso-bidi-language:AR-SA">O anterior estará fora de sincronia desde que o
vídeo é acelerado (ou reduzido sua velocidade) e o posterior estará em
sincronia desde que os quadros são acrescentados para convertê-lo a vfc.</span></p>
<h2>Referências</h2>
<p><a href="http://www.doom9.org/ivtc-tut.htm">http://www.doom9.org/ivtc-tut.htm</a>
 (vídeo híbrido , IVTC)<p>Documentação Decomb.<p><a href="http://www.masteryoshidino.com/hentai/anime-encoding.htm">http://www.masteryoshidino.com/hentai/anime-encoding.htm</a>
 (fazendo vídeo com 120 fps)
<p><a href="http://webpages.charter.net/falconx/decombvfrmod.html">http://webpages.charter.net/falconx/decombvfrmod.html</a>
(Decomb521VFR)
<p><a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=80673">http://forum.doom9.org/showthread.php?s=&amp;threadid=80673</a>
 (sobre mod Decomb521VFR1.0 para Matroska VFR automatizado)
<p><kbd>$Date: 2006/03/26 18:11:19 $ Portuguese translation by RoLon</kbd></p>
</body>
</html>
