<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>FFT3D GPU filter</title>
  <meta http-equiv="Content-Language" content="ru">
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
  <link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: fft3dgpu.htm,v 1.3 2006/12/13 21:01:40 fizick Exp $
-->
</head>
<body>

<h1>FFT3DGPU</h1>

<h2>Общая информация</h2>
<p><b>Автор:</b> Tonny Petersen aka tsp <br>
<b>Версия:</b> 0.6.4<br>
<b>Загрузка:</b> <a href="http://www.avisynth.org/tsp/">
http://www.avisynth.org/tsp/</a><br>
<b>Категория:</b> Разнообразные другие плагины (Misc Plugins)<br>
<b>Требования:</b> Цветовое пространство YV12, Графическая плата Directx 9<br>
<b>Лицензия:</b> GPL</p>

<h2>Инструкция</h2>

<p><code>FFT3DGPU</code> - это GPU версия фильтра Fizick'а <code><a
href="fft3dfilter.htm">FFT3DFilter</a></code>,
т.е. алгоритм (Быстрое Преобразование Фурье, шумодав) по большей части тот же.
К настоящему времени не реализована поддержка для чересстрочного видео,
цветового пространства YUY2 и метод образца шума
</p>
<p>В текущей версии, для оптимизации, <code>FFT3DGPU</code> запрашивает у
AVISynth'а следующий кадр, пока работает GPU.
Это означает, что фильтры идущие в тексте <b>до</b> <code>FFT3DGPU</code>
работают параллельно с ним.
</p>

<h3>Установка:</h3>
<p>Для использования данного фильтра необходим DirectX 9.0c или новее, а также
нужна графическая плата, аппаратно поддерживающая DirectX 9.
Это как минимум ATI Radeon 95xx или nVidia GeForce FX 5xxx. Рекомендуется
GeForce 6xxx или лучше.
Если Вы скачали Установщик (прим. пер.: исполняемый EXE-файл), просто запустите
его и он всё сделает за Вас,
иначе скопируйте fft3dgpu.hlsl и fft3dgpu.dll в одну и ту же директорию. Также
скопируйте d3dx9_27.dll в папку c:\windows\system32.<br>
В старых версиях есть fft3dgpu9b.dll (в данное время не поддерживается) для
Directx 9.0b
(<b>НЕ</b> копируйте обе dll в папку автозагрузки плагинов.)<br>
Возможно DirectX 9.0c быстрее на платах nVidia GeForce 6xxx поскольку там
добавлена поддержка PixelShader 3.0
Если У Вас нет последней версии DirectX (октябрь 2005) Вы можете скачать её
<a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=9930EFA6-9F7B-4C8A-AEA2-97DD6AB307A2&displaylang=ru"><cite>тут</cite></a>
или распаковать файл d3dx9_27.dll в папку c:\Windows\System32.
Установщик сам копирует d3dx9_27.dll нужное место, это означает, что его не надо
копировать, если у Вас уже установлен Directx 9c.
</p>

<h3>Синтаксис:</h3>

<p><code>FFT3DGPU</code>(<var>clip, float "sigma", float "beta", int "bw", int
"bh", int "bt", float "sharpen", int "plane", int "mode", int "bordersize", int
"precision", bool "NVPerf", float "degrid", float "scutoff", float "svr", float
"smin", float "smax", float "kratio", int "ow", int "oh", int "wintype"
</var>)</p>

<h3> Параметры функции:</h3>

<p><var>clip</var>: фильтруемый клип. Должен быть YV12.</p>

<p><var>sigma</var> и <var>beta</var> имеет те же значение как в
<code>FFT3DFilter</code>. По умолчанию = 1.</p>

<p><var>bw,bh</var>: ширина и высота блока. Должны быть степенью 2-ки, т.е.
правильные величины 4,8,16,32,64,128,256,512. 
(Заметьте, что <var>bw,bh</var> должно быть больше, чем 4 для наилучшего результата). По умолчанию = 32</p>

<p><var>bt</var>: способ фильтрации.<br>
  bt=-1 только повышение резкости,<br>
  bt=0 режим фильтра Кальмана,<br>
  bt=1 пространственный 2D фильтр Винера,<br>
  bt=2 используются предыдущий и текущий кадры.<br>
  bt=3 используются предыдущий, текущий и следующий кадры,<br>
  bt=4 используются два предыдущих, текущий и следующий кадры.<br>
По умолчанию = 1</p>

<p><var>sharpen</var>: положительные величины - степень повышения резкости,
отрицательные - уменьшают резкость.
 0 - отключает изменение резкости. По умолчанию = 0.</p>

<p><var>plane</var>: 0 - обрабатывать только канал яркости,<br>
 1,2 и 3 - синонимы, обрабатываются каналы цветности (оба - U и V).<br>
 4 - яркость и обе цветоразности.<br>
 По умолчанию = 0. </p>

<p><var>mode</var>: 0 - перекрытие 1:1. Это самый быстрый способ но с высокими
величинами сигмы возможны артефакты.<br>
 mode=1 режим полного перекрытия 2:1. Это самый медленный но с меньшими
артефактами.<br>
 mode=2 опять перекрытие 1:1, но с дополнительной границей. Это уменьшает
граничные артефакты видимые при <var>mode</var>=0.
Скорость между <var>mode</var> = 0 и 1.<br>
Фильтр Кальмана (<var>bt</var>=0) работает с <var>mode</var>=0. По умолчанию 1
<br>

<p><var>bordersize</var>: используется только с <var>mode</var>=2. Определяет
размер границы. По умолчанию 1.</p>

<p><var>precision</var>: 0: используется 16 битная вещественная арифметика
(половинная точность),<br>
 1: используются 32 битная вещественная арифметика (одинарная точность) для
преобразования Фурье (FFT) и 16 битная для фильтр Винера/Кальмана и повышения
резкости.<br>
 2: всегда использует 32 битную арифметику.<br>
 Использование 16 битной арифметику увеличивает скорость исполнения, но
уменьшает точность.
 На GeForce 6800 <var>precision</var>=0 примерно в 3 раза быстрее
<var>precision</var>=2, и <var>precision</var>=1 быстрее 1.33 раза, чем
<var>precision</var>=2. По умолчанию 0.</p>

<p><var>NVPerf</var>: Включает поддержку 
<a href="http://developer.nvidia.com/object/nvperfhud_home.html">
<cite>NVPerfHUD</cite></a>. По умолчанию = false. </p>

<p><var>degrid</var>: снижение сеточности.
Работает только когда <var>mode</var>=1.
Не работает с фильтром Кальмана (но работает для повышения резкости (если
включено) после фильтра Кальмана).
По умолчанию 1.0 для <var>mode</var>=1 и 0.0 для <var>mode</var> = 0 или 2</p>

<p><var>scutoff, svr, smin, smax</var>:то же самое, что для
<code>FFT3DFilter</code>. Управляет режимом повышения резкости.
По умолчанию <var>scutoff</var>=0.3, <var>svr</var>=1.0, <var>smin</var>=4.0,
<var>smax</var>=20.0</p>

<p><var>kratio</var>: Как и в <code>FFT3DFilter</code>. Порог сброса фильтра
Кальмана. По умолчанию 2.0</p>

<p><var>ow,oh</var>: работает только при <var>mode</var>=1. Определяет величину
перекрытие между блоками.
Размер перекрытия должен быть меньше или равный половине размера блока. По
умолчанию <var>ow=bw/2 ,oh=bh/2</var></p>

<p><var>wintype</var>: Изменяет тип окна анализа и синтеза. Аналогично
<code>FFT3DFilter</code><br>

<h3>ЧаВО:</h3>
<h4>	В: Что означает, когда я получаю в отдельном окне сообщение о
неожиданной ошибке с кодом: D3DERR_OUTOFVIDEOMEMORY.</h4>
<p>	О: Это означает, что для <code>FFT3DGPU</code> нужно больше памяти чем
доступно на графической плате.
	Короче, или Вы должны модернизировать видео плату, или пробовать
уменьшить разрешение, <var>bt,bh,bw,ow,oh</var>,
	или использовать <var>precision</var>=0, или <var>mode</var>=0 или 2</p>

<h4>	В: Какие настройки дают тот же результат как
<code>FFT3DFilter</code>?</h4>
<p>	О: <code>FFT3DGPU</code>(<var>mode=1,precision=2</var>) подобно
<code>FFT3DFilter()</code>, но пожалуйста заметьте,
	что <var>bw,ow,bh,ow</var> имеют другие значение по умолчанию.</p>

<h4>	В: Какие ещё существуют различия между <code>FFT3DFilter</code> и
<code>FFT3DGPU</code>?</h4>
<p>	О: Некоторые параметры из <code>FFT3DFilter</code> до сих пор
отсутствуют.</p>

<h4>	В: Почему <code>FFT3DGPU</code> медленнее по сравнению с
<code>FFT3DFilter</code>?</h4>
<p>	О: Или у вас медленная графическая карта подобно GeForce FX 5200, или Вы
не сильно используете CPU, например тяжелый кодек (подобно XviD/DivX)</p>

<h4>	В: Как мне использовать NVPerfHUD?</h4>
<p>	О: Установите <var>NVperf</var>=true и используя командную строку или
создав ярлык для запуска:<br>
	"Путь к NVPerfHUD\NVPerfHUD.exe" "Путь к VIRTUALDUBMOD\virtualdubmod.exe"
"Путь к AVS\test.avs"<br>
	и включите (разрешите) "force NON PURE device"</p>

<h4>	В: Я получаю сообщение об ошибке: "Only pixelshader 2.0 or greater
supported"</h4>
<p>	О: Это потому, что Вам нужна графическая плата с аппаратной поддержкой
DirectX 9.</p>

<h4>	Следующие видеокарты не поддерживаются:</h4>

<pre>Nvidia:
TNT
TNT2
GeForce 256
GeForce2 Ultra, Ti, Pro,MX,Go and GTS
GeForce3 Ti 200, Ti 500
GeForce4 Ti, MX, Go

ATI:
Radeon 7xxx
Radeon 8xxx
Radeon 90xx
Radeon 92xx

Matrox:
G2xx
G4xx
G5xx
может быть Parhelia
</pre>
	<h4>А эти должны работать:</h4>
<pre>Nvidia:
GeForce FX 5xxx
GeForce 6xxx
GeForce 7xxx

ATI:
Radeon 9500
Radeon 9550
Radeon 9600
Radeon 9700
Radeon 9800
Radeon Xxxx

где x - любая цифра. 	 
</pre>


<h3>Поддержка: </h3>
<p>В <a href="http://forum.doom9.org/showthread.php?t=89941"><cite>этой
ветке</cite></a> на форуме doom9
 или мой email адрес (tsp (coбaкa) person.dk).</p>

<h3>Планы на будущее:</h3>
<p>	Чересстрочное видео, YUY2, поддержка нескольких сигм и (может быть)
поддержка метода образца шума.
	Устранение всех глупых ошибок.
	Снова добавить версию для DirectX 9.0b.
</p>

<h3>История изменений:</h3>
<ul>
<li>0.1 Первый выпуск. Глюкавый и использовал (библиотеку) Brook</li>

<li>0.2 <var>sigma</var> должна сейчас работать аналогично
<code>FFT3DFilter</code></li>

<li>0.3 Переписан код, непосредственно использующий DirectX 9.0 и поддержка 16
битной вещественной арифметики, увеличилась и стабильность.</li>

<li>0.31 Исправление ошибки, вызывающее сеточность краёв.</li>

<li>0.4 Добавлены <var>sharpen, mode = 1 и 2, reduceCPU</var> и параллельная
обработка.</li>

<li>0.41 Исправлена ошибка при расчете PSD.</li>

<li>0.42 Исправлена утечка памяти при перезагрузке.</li>

<li>0.43 Исправлена ошибка, которая вызвала искажения на картах GeForce FX и
возможно утечки памяти.
	Добавлено больше комментариев в текст кода и небольшое улучшение фоновой
работы. Также добавлена поддержка DirectX 9.0b</li>

<li>0.44 <code>FFT3DGPU</code> теперь может перезагружать видеопроцессор при
потере его работоспособности и продолжать работу. Версия для Direcx 9.0b должна
теперь работать.</li>

<li>0.45 Исправление ошибки при фильтрации каналов цветности и <var>mode</var>=0
или 2 выводившие фильтр из строя.</li>

<li>0.46 Исправление блокировки в hyperthread машинах (надеюсь полностью). Также
исправлен бесконечный цикл при закрытии WMP 6.4.</li>

<li>0.46.1 Исправление которе при <var>nvperf</var>=true вызывало блокировку
<code>FFT3DGPU</code>. Добавлен раздел ЧаВО в этот файл.</li>

<li>0.47 Исправлена ошибка с плохими кадрами после перезагрузки повисшего
видеопроцессора. Переименовано readme.txt в fft3dgpu.txt.
	Используйте обновленную версию DirectX 9.0c, также пожалуйста <b>читайте
инструкцию по установке</b>!!!</li>

<li>0.5 Добавлен фильтра Кальмана, повышение резкости, <var>bt</var>=4 и
<var>degrid</var> из <code>FFT3DFilter</code>. Переименован ps.hlsl в
fft3dgpu.hlsl. Переписана часть кода. Добавлены новые ошибки.</li>

<li>0.5a Исправлена ошибка с <var>bt</var>=2. Изменения коснулись только файла
fft3dgpu.hlsl</li>

<li>0.51 Исправлена ошибка с параметрами после того, как NVPerf был перемещен.
т.е. <var>degrid=scutoff, scutoff=svr</var>. Улучшенная скорость загрузки из
GPU. На GeForce FX 5xxx теперь работает фильтр Кальмана.</li>
	
<li>0.6 Добавлены <var>wintypes</var>, <var>plane</var>=4 и переменный размер
перекрытия (<var>ow,ох</var>). Изменен параметр <var>useFloat16</var> на
<var>precision</var>. Изменено значение по умолчанию для <var>mode</var> на
1</li>

<li>0.6.1 теперь переменное перекрытие работает и на GeForce FX 5xxx. Значение
по умолчанию для <var>mode</var>=1 наконец.</li>

<li>0.6.2 Исправления: улучшена работа <var>Degrid</var> и убрана вертикальная
полосатость при <var>mode</var>=1.
Исчезли артефакты с правого края при ширине не кратной 8 и <var>plane</var>>0.</li>

<li>0.6.3 Переписан FFT. Должно быть быстрее на больших блоках и высокой точности
<var>precision</var>=2 (вплоть до 70%). Исправлен глюк с HC 0.17. Новая html документация
(спасибо Fizick'у за создание).</li>

<li>0.6.4 Новый FFT код теперь должен работать и на ATI картах.</li>
</ul>

<p>Исходный текст, документация и перевод выпущены под лицензией GPL, смотри
copying.txt</p>
<p><kbd>$English Date: 2006/06/11 17:25:07 $</kbd>
<br><kbd>Русский перевод 26.12.2005-08.06.2006 AI</kbd></p>
</body>
</html>