<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html lang="ru">
<head>
<meta http-equiv="Content-Language" content="ru">
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Write Avisynth Filter</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: write.htm,v 1.5 2008/12/06 17:51:58 fizick Exp $
-->
</head>
<body >
<h2>WriteFile / WriteFileIf / WriteFileStart / WriteFileEnd</h2>
<p><code>WriteFile </code>(<var>clip, string filename, <i>string expression1, 
  ... , string expression16, bool &quot;append&quot;, bool &quot;flush&quot;</i></var>)<br>
  <code>WriteFileIf </code>(<var>clip, string filename, <i>string expression1, 
  ... , string expression16, bool &quot;append&quot;, bool &quot;flush&quot;</i></var>)<br>
  <code>WriteFileStart </code>(<var>clip, string filename, <i>string expression1, 
  ... , string expression16, bool &quot;append&quot;</i></var>)<br>
  <code>WriteFileEnd </code>(<var>clip, string filename, <i>string expression1, 
  ... , string expression16, bool &quot;append&quot;</i></var>)</p>
<p><code>WriteFile</code> вычисляет выражения <var>expressionN</var>, превращает результат в строку и записывает её в 
файл.<br>
</p>
<p>Переменная <var>current_frame</var> устанавливается при вычислении выражения равной номеру текущего кадра<br>
  (аналогично работает ScriptClip, за подробностями см. эту документацию).<br>
  <var>current_frame</var> равна -1 при загрузке скрипта и -2 при закрытии скрипта.</p>
<p><code>WriteFile</code> выдаёт данные для каждого кадра, обрабатываемого фильтром. 
<code>WriteFileIf</code> действует подобно, но выдаёт их только если первое выражение
<var>expression1</var> = <code>true</code>. В обоих случаях при открытии и закрытии скрипта данные не выдаются.
Заметьте, что так как вывод произвотится только для "обрабатываемых" кадров, то вывода не будет,
если результат фильтра не использется для получения конечного результата скрипта. <br>
  <code>WriteFileStart</code> and <code>WriteFileEnd</code> выдают данные только при открытии или закрытии скрипта,
  не делая никаких действий на каждый кадр. В обоих случаях выражение вычисляется только однажды,
  в месте расположения фильтра в скрипте.</p>
<p>Если <var>append</var> = <code>true</code>, выдаваемая строка будет дописываться к существующему файлу.<br>
  Если <var>flush</var> = <code>true</code>, файл закрывается и снова открывается после каждой записи, т.о. вы можете
  немедленно видеть результаты (может замедлять работу).<br>
  Для фильтров <code>WriteFileStart</code> и <code>WriteFileEnd</code> <var>flush</var> всегда <code>true</code>.<br>
  По умолчанию <var>append</var> = <code>true</code> для всех фильтров группы, кроме <code>WriteFileStart</code> 
  (для него <code>false</code>).</p>
<h4>Работу фильтров лучше пояснить на простых примерах:</h4>

      
<pre>filename = &quot;c:\myprojects\output.txt&quot;
# создаём исходный клип
Version()

# здесь 'выражение' – это только переменная, вычисляемая на каждом кадре 
# и записываемая в файл. Файл будет содержать номера кадров на каждой строке.
WriteFile(filename, &quot;current_frame&quot;)

# эта строка записывается при открытии скрипта
WriteFileStart(filename, &quot;&quot;&quot; &quot;Заголовок файла&quot; &quot;&quot;&quot;)

# а эта – при закрытии
WriteFileEnd(filename, &quot;&quot;&quot; &quot;Скрипт закончил работу&quot; &quot;&quot;&quot;)</pre>
    
<p>Вы можете использовать тройные кавычки, чтобы поместить строку внутрь строки.</p>
<p>Если выражение не может быть вычислено, вместо него записывается сообщение об ошибке.<br>
В этом случае в функции <code>WriteFileIf</code> результат считается истинным, т.е. ошибка всегда записывается.</p>
<pre># выдаст сообщение &quot;I don't know what &quot;this&quot; means&quot;
WriteFile(filename, &quot;this is фуфло&quot;)</pre>
    <hr>
<h4><b>Есть и более простые способы записать номера кадров в файл, однако:</b></h4>
<p>... этот пример показывает, как использовать вычисляемую (&quot;runtime&quot;) функцию вместе с FrameEvaluate:</p>
      
<pre># создаёт исходный клип
Version.FadeIn(50).ConvertToYV12

# печатает номер кадра, двоеточие и среднюю яркость кадра.
colon = &quot;: &quot;
WriteFile(&quot;F:\text.log&quot;, &quot;current_frame&quot;, &quot;colon&quot;, &quot;AverageLuma&quot;)</pre>
<p>Можно также напечатать и текущее время:</p>
      
<pre># создаём исходный клип
Version.FadeIn(50).ConvertToYV12

# печатает номер кадра, текущее время и среднюю яркость кадра
# тройные кавычки нужны для того, чтобы поместить строку внутрь строки
WriteFile(last, filename, &quot;current_frame&quot;, &quot;&quot;&quot; time(&quot; %H:%M:%S&quot;) &quot;&quot;&quot;, &quot;AverageLuma&quot;)</pre>
    
<hr>
<h4>Ещё примеры:</h4>
<p>В функции <code>WriteFileIf</code> первое выражение должно выдавать логическое значение (true или false).<br>
  Только если оно даёт TRUE, вычисляются остальные выражения и печатается строка.<br>
  (Напоминаю: &amp;&amp; – логическое &quot;И&quot;, || – логическое &quot;ИЛИ&quot;, == – равно, != – не равно)<br>
  С помощью этой функции можно пропускать строки в выходном файле.</p>
<pre># создаём исходный клип
Version.FadeIn(50).ConvertToYV12

# печатает номер кадра только для тех кадров, средняя яркость которых лежит между 30 и 60
WriteFileIf(last, filename, &quot;(AverageLuma&gt;30) &amp;&amp; (AverageLuma&lt;60)&quot;, &quot;current_frame&quot;, &quot;&quot;&quot; &quot;:&quot; &quot;&quot;&quot;, &quot;AverageLuma&quot;)</pre>
<p><kbd>$English Date: 2008/11/16 13:59:30 $<br>
Русский перевод 18.05.2005 Eugene Vasiliev (eugvas<span>&#64;</span>mccme.ru)</kbd><br>
Обновления 06.12.2008 Fizick</p>
<FORM>
<INPUT TYPE="Button" VALUE="Back"
onClick="history.go(-1)">
</form>
</body>
</html>