<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html lang="ru">
<head>
<meta http-equiv="Content-Language" content="ru">
   <meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
   <meta name="Author" content="Wilbert Dijkhof">
   <title>ConditionalReader</title>
   <style type=text/css>
</style>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: conditionalreader.htm,v 1.4 2008/09/08 16:43:48 fizick Exp $
-->
</head>
<body>
<h2>
<a NAME="ConditionalFilter"></a>ConditionalReader
</h2>
<p><code>ConditionalReader </code>(<var>clip, string filename, string
variablename, bool &quot;show&quot;</var>)
<p><code>ConditionalReader</code> 
служит для импорта информации из текстового файла, отдельно для каждого кадра,
или только для некоторых кадров.
<h3>Параметры</h3>
<table border="1" width="61%">
  <tr>
    <td width="9%"><b>Параметр</b></td>
    <td width="76%"><b>Описание</b></td>
    <td width="15%"><b>Значение по умолчанию</b></td>
  </tr>
  <tr>
    <td width="9%">clip</td>
    <td width="76%">Исходный клип. Он не изменяется, если не задавать
        show=true.</td>
    <td width="15%">Отсутствует</td>
  </tr>
  <tr>
    <td width="9%">filename</td>
    <td width="76%">Файл, содержащий значения, которые будут присвоены переменным
	</td>
    <td width="15%">Отсутствует</td>
  </tr>
  <tr>
    <td width="9%">variablename</td>
    <td width="76%">Имя переменной, которой следует присвоить значения из файла
      </td>
    <td width="15%">Отсутствует</td>
  </tr>
  <tr>
    <td width="9%">show</td>
    <td width="76%">Если установлено в true, то значение, соответствующее
        текущему кадру, будет отображено поверх этого кадра.
      </td>
    <td width="15%">false</td>
  </tr>
</table>
<h3>Формат файла данных</h3>
<p>
Это обычный текстовый файл. Все разделители - пробелы, а новые
директивы начинаются каждый раз с новой строки. Регистр не имеет значения.
<br>
<br>
<b>TYPE (int|float|bool)</b>
<p>
Тип данных можно задавать только один раз для каждого файла.
В настоящий момент возможно использование только вещественных
(<i>float</i>), целых (<i>int</i>) или логических (<i>bool</i>) 
значений. Это определяется директивой  
<b>TYPE</b>. Она всегда должна идти первой, т.к. пока не определен тип
данных, ничего никуда не присваивается. Однажды заданный тип данных
изменить в ходе выполнения скрипта невозможно !
<p><b>DEFAULT &lt;value></b>
<p>Задает значение по умолчанию для всех кадров. Ставить эту директиву нужно
сразу после определения типа. Можно ее и не задавать, но тогда следует
убедиться что какие-то значения в явном виде заданы для всех кадров.
В противном случае поведение фильтра не определено.
<p><b>&lt;framenumber> &lt;value></b>
<p>Задает значение переменной для одного кадра с номером &lt;framenumber>.
<p><b>R &lt;startframe> &lt;endframe> &lt;value></b>
<p>Задает значение переменной для диапазона кадров. Обе границы
&lt;startframe> и &lt;endframe> включаются в диапазон.
<p><b>I &lt;startframe> &lt;endframe> &lt;startvalue> &lt;stopvalue></b>
<p>Линейная интерполяция в диапазоне кадров от &lt;startframe> до &lt;endframe>
значений от &lt;startvalue> до &lt;stopvalue>. Работает только для целых и
вещественных значений. Обе границы включаются в диапазон.
<h3>Типы данных</h3>
<p>Как уже говорилось, тип может быть вещественный
(<i>float</i>), целый (<i>int</i>) и логический (<i>bool</i>) 
&nbsp;<br>
<br>
<i>Целые</i> числа должны быть представлены в виде последовательности цифр, возможно 
со знаком.
<br>
<br>
<i>Вещественные</i> числа должны быть представлены в виде числа с десятичной
точкой, возможно со знаком, и возможно с буквой E или е на конце после которой
следует порядок числа. Например -732.103 или 7.12e4.<br>
<br>
<i>Логическое, или булево</i> значение может быть истина (<i>true</i>) или ложь (<i>false</i>).
<h3>Примеры</h3>
<h4>Простейший пример</h4>
<p>File.txt:
<pre>Type float
Default 3.45567

R 45 300 76.5654
2 -671.454
72 -671.454</pre>
<p>
Этот файл содержит вещественные числа. Значение по умолчанию  -  3.45567.  
Для кадров от 45 до 300 будет выдано значение 76.5654,
а для кадров 2 и 72 - -671.454.&nbsp;<br>
Как можно заметить, последующие директивы заменяют предыдущие значения. Например
кадр '72' - несмотря на то, что он находится внутри диапазона 45-300, будет
возвращено -671.454, как позже заданное. С другой стороны, если бы данный
диапазон был указан ПОСЛЕ строки '72 -671.454' - значение переменной
стало бы 76.5654.<br>
<br>
Скрипт для работы с этим файлом мог бы выглядеть так :
<pre>colorbars(512,512)
trim(0,500)
ScriptClip("subtitle(string(myvar))")
ConditionalReader("file.txt", "myvar", false)</pre>
<p>Этот скрипт помещает вычисленные значения в переменную 
"myvar", которая используется фильтром <a href="subtitle.htm">Subtitle</a>,
который в свою очередь вызывается из 
<a href="conditionalfilter.htm#ScriptClip">ScriptClip</a>.
В результате вычисленное значение отображается как титр.
<p><b>Заметьте!</b> Строка ConditionalReader() расположена <b>после</b> любого использования 
"myvar" в вашем скрипте.</p>
<h4>Управление наложением клипов</h4>
<p><b>AviSynth script:</b>
<pre>colorbars(512,256)
a1 = trim(0,600)
a2 = MessageClip("Text clip")
overlay(a1,a2, y = 100, x = 110, mode="subtract", opacity=0, pc_range=true)
ConditionalReader("opacity.txt", "ol_opacity_offset", false)
ConditionalReader("xoffset.txt", "ol_x_offset", false)</pre>
<p><b>xoffset.txt:</b>
<pre>Type int
Default -50

I 25 50 -50 100
R 50 250 100
I 250 275 100 250</pre>
<p><b>opacity.txt:</b>
<pre>Type float
Default 0.0

I 25 50 0.0 1.0
R 50 250 1.0
I 250 275 1.0 0.0</pre>
<p>
Этот скрипт задает значения для смещения по горизонтали и для прозрачности.
В кадрах 25->50 непрозрачность клипа увеличивается с
 0.0 до 1.0, в это же время текст плывет по экрану слева направо. 
Потом текст стоит на месте с кадра 50 по кадр 250, 
а после этого едет обратно, постепенно исчезая.
<br>
Проще посмотреть клип, чем подробно объяснить, что именно он делает.

<h4><a NAME="Applyrange"></a>Усложненный ApplyRange</h4>
<p>Как Вы могли заметить, использование большого числа вызовов <a href="animate.htm">ApplyRange()</a>
в скрипте может привести к проблемам с ресурсами. Использование <code>ConditionalReader</code> вместе с
<a href="conditionalfilter.htm">ConditionalFilter</a> может привести к эффективному решению.</p>
<p>File.txt:
<pre>Type Bool
Default False

2 True
R 45 60 True
72 True
R 200 220 True
210 False
315 True</pre>
<p>Указанный выше файл будет возвращать логические величины. Он по умолчанию будет возвращать False.
Однако для кадров 2, 45 to 60, 72, 200 до 220 и 315 исключая 210 он будет возвращать True.
Как вы могли заметить, последние изменения переназначают установки, сделанные в файле ранее.
Это иллюстрируется кадром '210' - даже хотя он внутри интервала
200-220, последняя величина, False, будет возвращена.<br>
<br>
Скрипт для использования этого файла, мог бы быть таким:
<pre>colorbars(512,512)
trim(0,500)
A=Last
FlipHorizontal() # Добавьте сложную цепочку фильтров
B=Last
ConditionalFilter(A, B, "MyVar", "==", "False", false)
ConditionalReader("File.txt", "MyVar", false)</pre>

<p>Это будет вводить величины в переменную, названную "MyVar", которая используется
<a href="conditionalfilter.htm">ConditionalFilter</a> для выбора между
необработанной и перевернутой версией источника.</p>

<p><b>Заметьте!</b> Строка ConditionalReader() расположена <b>после</b> любого использования 
"myvar" в вашем скрипте.</p>

<p><kbd>$Date: 2008/09/08 16:43:48 $<br>
Русский Перевод 27.05.2005 Alexander Nickolsky (anickol@yahoo.com)<br>
Обновления 10.04.2006 Fizick http://bag.hotmail.ru</kbd></p>
<form><input TYPE="Button" VALUE="Back"
onClick="history.go(-1)"></form>
</body>
</html>
