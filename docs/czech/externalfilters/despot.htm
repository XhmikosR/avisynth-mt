<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>DeSpot Plugin for Avisynth</title>
<link rel="stylesheet" type="text/css" href="../../avisynth.css">
<!--
Automatically generated, don't change:
$Id: despot.htm,v 1.1 2010/02/27 14:50:14 wilbertd Exp $
-->
</head>

<body>
<h1>DeSpot</h1>
<h2>Pøehled</h2>
<b>autor:</b>  Alexander G. Balachnin aka Fizick<br>
<b>verze:</b>      3.6.0 (založeno na Conditional Temporal Median Filter)<br>
<b>stáhnout:</b>  <a href="http://avisynth.org.ru/">http://avisynth.org.ru/</a>, <A 
href="http://avisynth.org/warpenterprises/">http://avisynth.org/warpenterprises/</A><br>
<b>kategorie:</b>   Pluginy pro vysílané video<br>
<b>požadavky:</b>
<ul>
  <li>YV12 Barevné prostøedí</li>
  <li>ISSE podpora</li>
</ul>
<hr>
<h4>DeSpot - Podmínìný èasový filtr pro odstraòování skvrn (teèek)</h4

<p>Tento filtr je navržen pro odstraòování èasového šumu ve formì bodù (skvrn) a proužkù nacházejících se v nìkterých videích.
Filtr je také užiteèný pro restauraci (vyèištìní) starých 8mm (a jiných) pomocí telecine pøevedených filmù  
od skvrn (pocházejících od pùsobení prachu na filmovém pásu) a nìkterých pruhù (škrábancù).</p>
<p>Plugin je založen na Conditional Temporal Median Filter v.0.93 (C-plugin pro Avisynth 2.5)<br>
od Kevina Atkinsona <a href="http://kevin.atkinson.dhs.org/temporal_median/"> http://kevin.atkinson.dhs.org/temporal_median/</a><br>
(Tento dokument je také založen na jeho dokumentaci.)</p>
<h3>Obrázky pøíkladù</h3>
<p>Polovina snímku z mého starého 8mm filmu (nahoøe - pøed, dole - po filtraci):</p>
<p><img border="0" src="../../english//pictures/externalfilters/despot1.jpg"></p>
<p> Avisynth skript pro tento pøíklad, který ukazuje práci staré verze filtru 0.93, ale adaptovaný do nové verze 3.2.</p>
<pre>AviSource(&quot;film8mm.avi&quot;)
LoadPlugin(&quot;despot.dll&quot;)
ConvertToYV12()
Crop(0,0,720,288) #pro zobrazení testu
i = last
# Porovnáme poloviny snímkù s a bez redukce šumu
DeSpot(p1=35, p2=14, pwidth=70, pheight=70, mthres=25, mwidth=20, mheight=15, interlaced=false,
  \  merode=33, ranked=false, p1percent=0, dilate=0, fitluma=false, blur=0, motpn=false, seg=0)
StackVertical(i, last)</pre>
<p>Stejný snímek po použití nìkterých parametrù z novìjší verze filtru 1.0 (horní polovina - s rozmazáním okrajù skvrn, spodní polovina - s èasovým vyhlazením ve statických oblastech):</p>
<p><img border="0" src="../../english//pictures/externalfilters/despot2.jpg"></p>
<p>Avisynth skript pro tento pøíklad :</p>
<pre>AviSource(&quot;film8mm.avi&quot;)
LoadPlugin(&quot;despot.dll&quot;)
ConvertToYV12()
Crop(0,0,720,288)
# Porovnáme snímky s rozmazáním, a s a bez èasové redukce šumu
i = last
# Porovnáme poloviny snímkù s a bez redukce šumu
b = DeSpot(i, p1=35, p2=14, pwidth=70, pheight=70, mthres=25, mwidth=20, mheight=15, interlaced=false,
  \  merode=33, ranked=false, p1percent=0, dilate=0, fitluma=false, blur=4, motpn=false, seg=0)
t = DeSpot(i, p1=35, p2=14, pwidth=70, pheight=70, mthres=25, mwidth=20, mheight=15, interlaced=false,
  \  merode=33, ranked=false, p1percent=0, dilate=0, fitluma=false, blur=4, motpn=false, seg=0, tsmooth=3)
StackVertical(b, t)</pre>
<p>V nových verzích filtru jsou uvedeny nìkteré doplòkové parametry, pro správnìjší detekci skvrn a odstraòování skvrn bez artefaktù.</p>
<h3>Potøebný software</h3>
<ol>
  <li>Tento program je pluginem (filtrem) pro Avisynth 2.5  (http://www.avisynth.org).
    Testován s verzemi 2.53 a 2.55. Verze 2.54 také mùže být použita.</li>
  <li>Staré verze filtru pøed 2.0 (naposledy 1.3) potøebovaly Avisynth C rozhraní (avithynth_c.dll) od Kevina Atkinsona.
    S tím byly nìkdy problémy.</li>
  <li>Nový filtr od verze 2.0 je nativní Avisynth plugin a NENÍ potøeba C-rozhraní.</li>
</ol>
<h3>Použití</h3>
<p>DeSpot mùže být naèten jako jakýkoli Avisynth plugin, buï vložením do složky Plugins nebo použitím LoadPlugin.
Základní použití:</p>
<pre>AviSource(&quot;d:\video.avi&quot;)  # vstup MUSÍ být YV12
LoadPlugin(&quot;despot.dll&quot;)
ConvertToYV12()
DeSpot(p1=35, p2=14, mthres=25)</pre>
<p>Filtr mùže pracovat ve 2 hlavních režimech, pøepínaných parametrem <var>median</var> (od verze 2.0):<br>
<var>median</var> (true nebo false, výchozí = false),<br>
false - režim odstraòování skvrn -  filtr se pokusí identifikovat šum a eliminovat ho.<br>
true - prostý mediánový režim - filtr použije prostý èasový mediánový filtr na
nehybné oblasti obrazu.</p>
<p>Syntaxe výzvy funkce:</p>
<p><code>DeSpot</code>(<var>clip, int "mthres", int "mwidth", int "mheight",
int "merode", bool "interlaced", bool "median", int "p1", int "p2", int "pwidth",
int "pheight", bool "ranked", int "sign", int "maxpts", int "p1percent",
int "dilate", bool "fitluma", int "blur", int "tsmooth", int "show", int "mark_v", 
bool "show_chroma", bool "motpn", int "seg", bool "color", int "mscene", int "minpts",
clip "extmask", bool "planar"</var>)
</p>
<h4>Parametry pro DeSpot v režimu odstraòování skvrn jsou:</h4>
<p><var>p1</var> (výchozí 24)<br>
<var>p2</var> (výchozí 12)<br>
    Pixel se musí lišit od svých sousedù o nejménì 'P1' v jasové složce, aby byl považován za šum. Okolní pixely se musí
lišit o nejmìnì 'P2' , aby byly považovány za souèást stejné skvrny.</p>
<p><var>pwidth</var> (výchozí 6)<br>
<var>pheight</var> (výchozí 5)<br>
    Skvrna nemùže být širší než <var>pwidth a vyšší než pheight</var></p>
<p><var>ranked</var> (true nebo false, výchozí=true)<br>
Zapíná režim žebøíèkového øazení rozdílu detektoru skvrn se 6 body místo 2.</p>
<p><var>sign</var> (výchozí 0)<br>
    Nastavuje režim pro odstraòování jen èerných nebo bílých skvrn nebo obojího:<br>
sign = 0 - jakékoli skvrny a jejich okolí (výchozí)<br>
sign = 1 - jen èerné (tmavé) skvrny a jejich tmavé okolí<br>
sign = -1 - jen bílé (svìtlé) skvrny a jejich svìtlé okolí<br>
sign = 2 - jen èerné (tmavé) skvrny a jejich jakékoli okolí<br>
sign = -2 - jen bílé (svìtlé) skvrny a jejich jakékoli okolí</p>
<p><var>maxpts</var> (od 0 do 10000000, výchozí=0 -   bez omezení)<br>
Nastavuje horní limit bodù (pixelù) na každou skvrnu.</p>
<p><var>minpts</var> (od 0 do 10000000, výchozí=0 -   bez omezení)<br>
Nastavuje spodní limit bodù (pixelù) na každou skvrnu.</p>
<p><var>p1percent</var> (od 0 do 100, výchozí=10)<br>
Nastavuje spodní limit relativní èásti vysoce kontrastních (podle kriteria P1) pixelù na skvrnu (v procentech).</p>
<p><var>dilate</var> (od 0 do 255, výchozí=1)<br>
Nastavuje rozsah morfologického rozšíøení (rùstu) odstranìné skvrny (v pixelových jednotkách).<br>
<br>
<var>fitluma</var> (true nebo false, výchozí=true)<br>
    Zapíná urèitou korekci jasu v místech vymazaných skvrn.</p>
<p><var>blur</var> (od 0 do 4, výchozí 1)<br>
    Hodnota (délka) lokálního prostorového rozmazání poblíž okrajù smazané skvrny.<br>
<br>
<var>tsmooth</var> (od 0 do 127, výchozí 0)<br>
    Ovládá èasové vyhlazení ve statických oblastech (mimo skvrn a pohybu).<br>
Nastavuje pøibližnou prahovou hodnotu variace jasu pixelu ve 3 snímcích,<br>
Èím více variace pøekroèí tuto prahovou hodnotu, tím menší bude èasové vyhlazení.<br>
0 - žádné èasové vyhlazení.</p>
<p><var>motpn</var> (true nebo false, výchozí = true)<br>
Definuje metodu detekce pohybu.<br>
false - detekuje pohyb z pøedchozího k aktuálnímu a z aktuálního k následujícímu snímku (stará metoda použitá ve všech verzích pøed 3.0)<br>
true - detekuje pohyb z pøedchozího k následujícímu snímku (nová metoda od verze 3.0)</p>
<p><var>seg</var> (od 0 do 2, výchozí=2)<br>
Ovládá metodu odstraòování segmentù skvrn.<br>
0 - odstraní jen pixely, které nejsou pøekryty zónami pohybu (stará metoda použitá ve všech verzích pøed 3.0, nejsilnìjší odstraòování);<br>
1 - odstraní jen takové èarové segmenty, které nejsou pøekryty zónami pohybu;<br>
2 - odstraní jen takové celé skvrny, které nejsou pøekryty zónami pohybu (nejbezpeènìjší).</p>
<p><var>color</var> (true nebo false, výchozí = false)<br>
Ovládá korekci barev na místech odstranìných skvrn.<br>
true - mìní barvu pixelù na místech odstranìných skvrn na støední hodnotu z pøedchozího, aktuálního a následujícího snímku,<br>
false - nemìní barvu pixelù na místech odstranìných skvrn.</p>
<p><var>mscene</var> (od 0 do 100, výchozí=40)<br>
Nastavuje procento pixelù v pohybu pro detekci zmìny scény a vypnutí odstraòování skvrn ze snímku.</p>
<p><var>extmask</var> (výchozí none)<br>
Volitelný klip s externí maskou. Bude binarizován s prahovou hodnotou 127 a logicky pøidán (operací "NEBO") 
k vnitøní masce pohybu. 
Mùže být použit pro doplòkovou ochranu dobrých objektù (pokud máte nìjakou vhodnou masku). 
</p>
<h4>Parametry DeSpot spoleèné pro oba režimy jsou:</h4>
<p><var>mthres</var> (výchozí 16)<br>
    Pixel se musí lišit od jiného snímku nejménì o 'MTHRES' , aby byl považován za pohyblivý. Toto èíslo by mìlo být 
vìtší než 'P2' aby se zabránilo identifikování šumu jako pohybu.</p>
<p><var>mwidth</var> (výchozí 7)<br>
<var>mheight</var> (výchozí 5)<br>
    Toto definuje šíøku a výšku bloku pro mapu pohybu odšumovacího algoritmu (erozivní a dilataèní cestou).</p>
<p><var>merode</var> (výchozí = 33)<br>
    Tento definuje prahovou hodnotu procenta pohyblivých pixelù v bloku ve stadiu eroze.</p>
<p><var>interlaced</var> (true nebo false)<br>
    Zda zpracovat video jako prokládané nebo ne (progresivní). Výchozí je pro DeSpot false (progresivní) od verze 1.3.
(Ve starších verzích bylo ve výchozím nastavení video založené na polích zpracováváno jako prokládané - a to byla chyba).</p>
<p>&nbsp;&nbsp;&nbsp;Aby jste namísto odstraòování skvrn vidìli mapu pohybu a šumu, který by byl eliminován, použijte parametr:<br>
<var>show</var> (0, 1, 2, výchozí=0)<br>
0 - nezobrazuje,<br>
1 - jen zvýrazní šum, místo jeho odstranìní<br>
2 - zobrazí mapu pohybu a šumu</p>
<p>&nbsp;&nbsp;&nbsp;Pokud <var>show</var>=1, mùžete použít doplòkový parametr pro zmìnu barev zvýraznìní,<br>
<var>mark_v</var> (0 až 255, výchozí= 255)<br>
    Kde <var> mark_v</var> je hodnotou jasu pro zvýraznìní šumu.<br>
Barva šumu (rùžová, zelená nebo šedá) nyní závisí na paritì (sudosti) <var>mark_v</var>.<br>
Také je zobrazena mapa pohybu sníženým kontrastem.</p>
<p>Pokud <var>show</var>=2, jas je zmìnìn následovnì:<br>
255 (bílá): Šum, který bude odstranìn<br>
159: Šum, který nebude odstranìn, protože by to mohl být pohyb<br>
95: Mapa pohybu pro aktuální obraz</p>
<p><var>show_chroma</var> (true nebo false)<br>
 Použijte pro zobrazení barevných dat klipu v mapì pohybu.</p>
<p><var>planar</var> : znak pro použití speciálního planárního barevného formátu pro YUY2 klipy, jak na vstupu tak na výstupu funkce. 
Používá speciální trik pro zachování snímkù s planární barevnou organizací dat 
(samostatné plochy Y, U, V v pamìti) v normálním prolínaném formátu YUY2 snímkù jako kontejneru. 
Tak se mùžeme vyhnout èetným vnitøním pøevodùm prolínaného formátu do planárního a zvýšíme tím rychlost.
Mùžete pøevést normální prolínaný YUY2 zdrojový klip do planárního formátu pomocí funkce <code>interleaved2planar</code> 
z pluginu <a href="http://home.pages.at/kassandro/RemoveGrain/">RemoveGrain od kassandro</a>,
a pøevést finální výsledek pomocí funkce <code>planar2interleaved</code> . 
Tento speciální planární YUY2 formát je podporovaný také v pluginu Removegrain od Kassandro, pluginu MaskTools2 od Manao a nìkterých dalších.
Tento trik nebude potøeba v Avisynthu v2.6 s nativní podporou planárního YV16 formátu.
Tento parametr je ignorován u YV12 klipù. 
Výchozí je planar=false (a vyskoèí vám pro YUY2 chyba).</p>

<h3>VYLADÌNÍ PARAMETRÙ</h3>
<p>Aby filtr pracoval dobøe, MUSÍ být správnì nastaveny rùzné parametry. Neexistují dobré výchozí hodnoty.</p>
<p>První parametr, který potøebujete nastavit je <var>interlaced</var>, nastavte ho na true
pokud je vaše video prokládané, jinak nechte false.</p>
<p>Pak musí být nastaveny <var>pwidth</var> a <var>pheight</var>. Nastavte je aby byly mírnì
vìtší než skvrny, které chcete odstranit. Pokud je vaše video prokládané, tak výška reprezentuje výšku jednoho pole.
Tedy bude v podstatì zdvojnásobena.</p>
<p>Pak je potøeba nastavit <var>p1</var>, <var>p2</var>, a <var>mthres</var> . Obecnì je <var>p1 > mthres > p2</var>.
Pokud jsou nastaveny pøíliš nízko, tak by jste mohli ztratit detaily, protože malé variace pixelu mohou být chybnì považovány za skvrny, a ještì dùležitìjší je,
že skuteèné skvrny nemusí být rozpoznány, protože velikost toho co filtr bere jako skvrnu mùže být vìtší než <var>pwidth</var> na <var>pheight</var>.
<var>show</var>=1 nebo 2 by mohlo být užiteèné pøi nastavování tìchto parametrù.</p>
<p>Parametry <var>mwidth</var>, <var>mheight</var> definují rozsah vlivu zón pohybu
na zóny šumu (skvrn). Pro snížení chybných detekcí skvrn ve scénách s rychlým pohybem,
je mùžete zvýšit. Potom, pro zrušení vlivu velmi malých zón pohybu,
mùžete zvýšit parametr <var>merode</var> (relativnì) .</p>
<p>Pak mùžete nastavit parametr <var>sign</var> , pokud jsou témìø všechny skvrny bílé nebo jen èerné.
Správné nastavení sníží poèet chybných detekcí skvrn a artefaktù.</p>
<p>Doporuèuji použít nový parameter <var>ranked</var>=true pro stabilitu detekce skvrn v zašumìlém videu.</p>
<p>Použijte parameter <var>maxpts</var> jako další metodu (navíc k <var>pwidth</var> a
<var>pheight</var>) jako ochranu pøed vymazáním pøíliš velkých objektù - pravdìpodobnì ne skvrn.</p>
<p>Použijte <var>p1percent</var> pro nevymazání slabých (málo kontrastních) skvrn s malým relativním poètem
kontrastních bodù (podle <var>p1</var> ).</p>
<p>Pro lepší odstranìní èásteènì poškozených pixelù blízko neostrých hranic skvrn mùžete zvýšit velikosti skvrn zvýšením parametru
<var>dilate</var>.</p>
<p>Zapnìte korekci jasu v místech smazaných skvrn parametrem <var>fitluma</var>.</p>
<p>Tato korekce je lokální (založená na èárových segmentech) v režimu <var>seg</var>&gt;0  a musí být použita
s øádnì definovaným rozšíøením skvrn, aby se zabránilo chybné korekci kvùli neostrým hranám skvrn.</p>
<p>Pro snížení viditelnosti nìkterých okrajù na místech smazaných skvrn o trochu více,
nastavte lokální prostorové vyhlazení parametrem <var>blur</var>.</p>
<p>Pro odšumìní témìø statických oblastí zkuste použít èasové vyhlazení s parametrem <var>tsmooth</var> kolem 4-8.</p>
<p>Pokud mají skvrny nìjakou barvu, zkuste zapnout parametr <var> color</var> pro opravu barev skvrn.</p>
<p>Pro zabránìní artefaktù ve zmìnách scény, snižte parametr <var>mscene</var> .</p>
<p>Také mùžete zkusit použít klip s externí maskou (parametr <var>extmask</var> ) jako doplnìk (nebo náhradu) vnitøí masky pohybu
pro ochranu dobrých objektù. Napøíklad to mùže být maska pohybu invertovaná SAD maska z pluginu MVTools.</p>
<h3>JAK PRACUJE</h3>
<h4>Filtr pracuje v režimu Denoise následovnì:</h4>
<p>1a) Nachází pixely, které se liší od jejich sousedù aspoò o <var>p1</var>.<br>
Pokud je prametr <var>ranked</var> true (nová metoda od verze 1.2), 3 sousedi v pøedchozím snímku (x-1, x, x+1)
a stejní 3 sousedi v následujícím snímku jsou seøazeni (podle hodnoty), a jejich minimum a maximum se použije pro výpoèet aktuálního rozdílu jasu od pixelu (x).<br>
    Pokud je parametr <var>ranked</var> false (stará metoda),&nbsp;použije se jen jeden soused v pøedchozím snímku (na stejné pozici x) a jeden soused v následujícím 
snímku pro výpoèet minima a maxima.<br>
    Pokud není parametr <var>sign</var> roven 0, zahrnuje se také znak (sign) rozdílnosti.<br>
    Tyto pixely jsou slouèeny do horizontálních èárových segmentù.<br>
Shluky èárových segmentù jsou slouèeny do skvrn.</p>
<p>1b) Zvìtšuje okolí zárodku <var>p2&lt;p1</var>.</p>
<p>2a) Urèuje velikost skvrn a vyhazuje (neoèistí) všechny vìtší než <var>pwidth x pheight</var>.<br>
Pokud je parametr <var>numpts</var> nastaven, velké skvrny jsou také vylouèeny ze zpracování.<br>
Pokud je nastaven parametr <var>p1percent</var> , pak slabé (podle kritéria <var>p1</var>) skvrny, které vìtšinou sestávají z okolí (podle kriteria <var>p2</var>), jsou také vylouèeny.</p>
<p>2b) Pokud je nastaven režim <var>Dilate</var> , tak jsou skvrny rozšíøeny aby zakryly své nekontrastní hrany
a malé prodlevy mezi nimi, pomocí operace morfologického rozšíøení k mapì šumu (skvrn).</p>
<p>3a) Najde pohyblivé oblasti v obrazu jednoduchým porovnáním každého pixelu s jiným snímkem a zkoumá všechny ty, které
jsou vìtší než <var>mthres</var>.<br>
    Pokud je <var>motpn</var>=false, definuje se pohyb od pøedchozího k aktuálnímu snímku,<br>
pokud je <var>motpn</var>=true, definuje se pohyb od pøedchozího k následujícímu snímku.</p>
<p>3b) Oznaèí pohybové pixely bez šumu s váhou 3 v mapì pohybu.<br>
Pokud je <var>motpn</var>=false, oznaèí pixely urèené jako pohyb i šum s váhou 1 na mapì pohybu.</p>
<p>4) Odstraòuje šum i malé oblasti z mapy pohybu erozivní metodou a pak i jejich rozšíøení (protože to je vše morfologické otvírání).<br>
Ve fázi eroze je mapa pohybu erodována v rozsahu <var>mwidth</var>/2 a <var>mheight</var>/2,
a zóny s malou sumární váhou (menší než 3*<var>merode</var>/100)  jsou sníženy nebo úplnì odstranìny z mapy pohybu. Takové zóny odpovídají
malému relativnímu (v procentech) poètu pohyblivých sousedù uvnitø tohoto rozsahu (nebo vìtšinì šumových pixelù - skvrnám).<br>
Ve fázi rozšiøování jsou zbývající zóny pohybu zvìtšeny se stejným rozsahem. To jsou pravdìpodobnì nejdùležitìjší kroky (obzvláštì pro <var>motpn</var>=false) .</p>
<p>4a) Jestliže procento  pohyblivých pixelù je vìtší než parametr <var>mscene</var> , plugin detekuje zmìnu scény, a celá mapa pohybu je nastavena jako pohyblivá.</p> 
<p>4b) Pøidává volitelnou externí masku pro maskování pohybu.</p> 
<p>5) Odstraòuje jen skvrny, ve kterých nebyl žádný pohyb (v aktuálním snímku nebo následujícím snímku jestliže <var>motpn</var>=false).<br>
V režimu odstraòování pixelù (<var>seg</var> = 0), provìøuje a odstraòuje jen pixely, které se nepøekrývají zónami pohybu.<br>
V režimu odstraòování segmentù (<var>seg</var> = 1), provìøuje a odstraòuje jen segmenty, které se nepøekrývají zónami pohybu.<br>
V režimu odstranìní skvrn (<var>seg</var> = 2), provìøuje a odstraòuje jen skvrny, které se nepøekrývají zónami pohybu. 
Je to nejbezpeènìjší režim, s minimem artefaktù chybných odstranìní.</p>
<p>6) Volitelnì provede korekci jasu v místì odstranìných pixelù a prostorové vyhlazení blízko okrajù skvrn.</p>
<p>7) Volitelnì provede èasové vyhlazení statických oblastí.</p>
<p>8) Volitelná korekce barev v místì skvrn.</p>

<h4>Filtr mùže být také nakonfigurován pro následující zpùsob práce (prostý mediánový režim):</h4>
<p>1) Nalézá pohyblivé oblasti obrazu prostým porovnáním každého pixelu s pøedchozím snímkem a uvažuje všechny takové, které
jsou vìtší než <var>mthres</var>.</p>
<p>2) Odšumuje mapu pohybu erozí a pak rozšiøuje (t.j. morfologické otvírání).
To je pravdìpodobnì nejdùležitìjší krok.</p>
<p>3) Použije prostý èasový mediánový filtr na nepohyblivé èásti obrazu.</p>
<h3>POZNÁMKY K OPTIMALIZACI</h3>
<p>DeSpot je od verze 3.2 ruènì optimalizován pro Integer SSE (Pentium3, Athlony jsou nyní vyžadovány).<br>
Urychlení je asi o 30%.</p>
<h3>KOMPILOVÁNÍ</h3>
<p>Fizick verze nad 1.1 jsou kompilovány ve free MS VC++ Toolkit 2003 s MS Platform SDK.</p>
<p>Poznámka: zkopírujte ztracené nmake.exe a cvtres.exe ze složky Bin\win64 do složky Bin.</p>
<p>MS VC6, VC7 mohou být také použity.</p>
<p>Použijte soubor "makefile.exe" s pøíkazem: nmake</p>
<p>Staré verze C-pluginu do 1.3 mohou být kompilovány pomocí GCC-g++ 3.3.1, MinGW 3.0.0-1, MSYS 1.09. Nové verze nad 2.0 tak kompilovat nelze.</p>
<h3>KOMBINOVANÉ POUŽITÍ</h3>
<p>Velmi dobrých výsledkù je možné dosáhnout kombinací tohoto filtru s odhadem a kompenzací pohybu:
globálního pohybu s pluginem <a href="depan.htm">DePan</a> (od Fizick), nebo lokálního pohybu s pluginem
<a href="mvtools.htm">MVTools</a> (od Manao).</p>
<p>V takovém pøípadì jsou pixely z pøedchozího a následujícího snímku posunuty, aby nejlépe zapadly do aktuálního snímku,
èímž se snižuje relativní pohyb, sníží se chybné detekce skvrn, a zlepší se redukce šumu.</p>
<p>Pøíklad skriptu s DePan 0.9 (mùžete nastavit volitelné parametry DePanEstimate a DepanInterleave):</p>
<pre>AviSource(&quot;h:\kino.avi&quot;)
LoadPlugin(&quot;depan.dll&quot;)
LoadPlugin(&quot;despot.dll&quot;)
i = ConvertToYV12()
d = DePanEstimate(trust=3)
DePanInterleave(i, data=d)
DeSpot(p1=30, p2=15, pwidth=800, pheight=600, mthres=20, motpn=true, dilate=1, seg=1)
SelectEvery(3, 1)</pre>
<p>Pøíklad skriptu s MVTools 0.95 (mùžete nastavit volitelné parametry MVAnalyse):</p>
<pre>AviSource(&quot;h:\kino.avi&quot;)
LoadPlugin(&quot;mvtools.dll&quot;)
LoadPlugin(&quot;despot.dll&quot;)
i = ConvertToYV12()
vf = MVAnalyse(i, isb=false, lambda=2000)
f = MVCompensate(i, vf)
vb = MVAnalyse(i, isb=true, lambda=2000)
b = MVCompensate(i, vb)
Interleave(f, i, b)
DeSpot(p1=30, p2=12, mthres=20, dilate=2, fitluma=true, blur=2, seg=2)
SelectEvery(3,1)</pre>
<p>Pøíklad skriptu s externí maskou z pluginu MVTools v0.9.13.2 a výše
(mùžete nastavit volitelné parametry MVAnalyse):</p>
<pre>
LoadPlugin(&quot;mvtools.dll&quot;)
LoadPlugin(&quot;masktools.dll&quot;)
LoadPlugin(&quot;degrainmedian.dll&quot;)
LoadPlugin(&quot;despot.dll&quot;)

AviSource(&quot;h:\kino.avi&quot;)
i = ConvertToYV12()
prefilt=i.DeGrainMedian() # pøedfiltrováno pro lepší analýzu pohybu

# analyzujeme a kompenzujeme pohyb vpøed a zpìt (k aktuálnímu snímku)
ml = 100     # mìøítko masky
thscd1 = 400 # zmìna scény

vf = prefilt.MVAnalyse(isb=false, truemotion=true) # dopøedné vektory 
cf = i.MVFlow(vectors=vf, thscd1 = thscd1) # pøedchozí snímek, kompenzovaný vpøed
sadf = MVMask(vectors=vf, ml=ml,kind=1,gamma=1, thscd1 = thscd1) # maska SAD vpøed
msadf=sadf.Binarize() # binární invertovaná maska SAD vpøed

vb = prefilt.MVAnalyse(isb=true, truemotion=true)  # zpìtné vektory 
cb = i.MVFlow(vectors=vb, thscd1 = thscd1) # následující snímek, kompenzovaný zpìt 
sadb = MVMask(vectors=vb, ml=ml, gamma=1, kind=1, thscd1 = thscd1) # maska SAD zpìt
msadb = sadb.Binarize() # binární invertovaná maska SAD zpìt

msad = Logic(msadf,msadb,"OR") # kombinovaná invertovaná maska SAD
msad = msad.Expand() # rozšíøená invertovaná maska SAD
msadi = Interleave(msad, msad, msad) # 3krát opakovaná invertovaná maska SAD
# Tato maska je vysoká (255) kde je nejménì jeden odhad pohybu dobrý, 
# takže tyto oblasti budou chránìny

Interleave(cf,i,cb) # prolínáme (øadíme) dopøednì kompenzovaný, zdrojový, a zpìtnì kompenzovaný snímek

DeSpot(p1=30,p2=12,pwidth=800,pheight=600,mthres=20,merode=33,\
   sign=0,show=1,seg=0,color=true,motpn=true, extmask=msadi)

SelectEvery(3,1) # dostaneme filtrovaný zdroj
</pre>
<h3>DOPLÑKOVÁ INFORMACE</h3>
<p>Diskuze o filtru ConditionalTemporalMedian a filtru Despot :
<cite><a href="http://forum.doom9.org/showthread.php?s=&amp;threadid=59388">http://forum.doom9.org/showthread.php?s=&amp;threadid=59388</a></cite></p>
<h3>LICENCE</h3>
<p>Tento program je svobodný software; mùžete ho redistribuovat a/nebo opravovat pod podmínkami GNU General Public License publikované
Free Software Foundation; buï verze 2 Licence, nebo (podle vaší volby) nìkteré pozdìjší verze.</p>
<p>Tento program je šíøen v nadìji, že bude užiteèný, ale BEZ JAKÉKOLI ZÁRUKY; dokonce bez pøedpokládané záruky OBCHODOVATELNOSTI  
nebo POUŽITÍ PRO KONKRÉTNÍ ÚÈELY. Viz GNU General Public License pro více podrobností.</p>
<p>Spolu s tímto programem by jste mìli obdržet kopii GNU General Public License; pokud ne, napište do Free Software Foundation.
Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</p>
Dokumentace je šíøena pod <a href="http://creativecommons.org/licenses/by-sa/3.0/">CreativeCommons BY-SA 3.0 license.</a>

<p>Zvažte prosím dotaci, aby jste se stali registrovaným uživatelem.</p>

<h3>SEZNAM ZMÌN VERZÍ</h3>
<ul>
  <li>Version 3.6.0 (October 23, 2008):
    <ul>
      <li>Added planar option for YUY2 planar format.</li>
      <li>Fixed memory leakage in constructor (for show modes).</li>
      <li>Some changes to prevent crashes.</li>
      <li>Finally fixed strange read access bug with extmask (extmask was disabled for motpn=true, seg=0 in v3.5.1)</li>
    </ul>
  </li>
  <li>Version 3.5.1 (Dec 20, 2007):
    <ul>
      <li>Recompiled to fix strange read access bug. Thanks to Øóøàíèêà for report.</li>
    </ul>
  </li>
  <li>Version 3.5.0 (July 14, 2006):
    <ul>
      <li>Corrected documentation example (msadb). Thanks to johnmeyer for report.</li>
    </ul>
  </li>
  <li>Version 3.5 (November 26, 2005):
    <ul>
      <li>Added external motion mask clip option and example.</li>
      <li>Changed default <var>motpn</var>=true (was really false, contrary to documentation).</li>
    </ul>
  </li>
  <li>Version 3.4.0 (June 18, 2005):
    <ul>
      <li>Reformatted doc.</li>
    </ul>
  </li>
  <li>Version 3.4 (April 11, 2005):
    <ul>
      <li>Added parameter <var>minpts</var>.</li>
    </ul>
  </li>
  <li>Version 3.3.3 (March 30, 2005):
    <ul>
      <li>Fixed bug with <var>median</var> mode (thanks to slk001 for report).</li>
    </ul>
  </li>
  <li>Version 3.3.2 (March 28, 2005):
    <ul>
      <li>More correct clip cache range (now =2 in place of undefined).</li>
    </ul>
  </li>
  <li>Version 3.3.1 (October 8, 2004):
    <ul>
      <li>Fixed bugs with scene change detection..</li>
    </ul>
  </li>
  <li>Version 3.3 (August 4, 2004):
    <ul>
      <li>Added <var>mscene</var> parameter for scene change detection.</li>
    </ul>
  </li>
  <li>Changes 3.2 (July 4, 2004) from 3.1 (Fizick):
    <ul>
      <li>Corrected enabling and disabling of temporal smooth for some  modes.</li>
      <li>Changed temporal smooth method to more fast but simpler, new tsmooth is similar to old tsmooth*2.</li>
      <li>Restored median mode processing as was before version 3.0.</li>
      <li>Partial  ISSE optimization for speed increasing (Pentium3 or Athlon is needed now).</li>
      <li>Updated doc.</li>
    </ul>
  </li>
  <li>Changes 3.1 (June 27, 2004) from 3.0
(Fizick):
    <ul>
      <li>Added color correction at place of removed spots.</li>
    </ul>
  </li>
  <li>Changes 3.0 (June 22, 2004) from 2.1
(Fizick):
    <ul>
      <li>Version 3.0 is major release update (probably alpha with bugs):</li>
      <li>Added another motion detection method "<var>motpn</var>" (previous to next frame).</li>
      <li>Added segments removing methods "<var>seg</var>"=1,2.</li>
      <li>Changed luma correction to local in segments (spots) removing mode.</li>
      <li>Removed "<var>mratio</var>"  parameter (reset as internal constant =3 as in all versions prior 2.1).</li>
      <li>Changed some defaults.</li>
      <li>Code reorganization.</li>
      <li>Updated doc.</li>
    </ul>
  </li>
  <li>Changes 2.1 (June 14, 2004) from 2.0
(Fizick):
    <ul>
      <li>Added parameter "<var>mratio</var>"  parameter (it was internal =3 in all previous versions).</li>
      <li>Changed default of  "<var>merode</var>" to dependent from "<var>mratio</var>".</li>
      <li>Updated doc.</li>
      <li>At last I begin to understand how the filter works at motion denoising stage  :-).</li>
    </ul>
  </li>
  <li>Changes 2.0 (June 10, 2004) from 1.3
(Fizick):
    <ul>
      <li>Version 2.0 is major release update (probably alpha with bugs):</li>
      <li>Main interface code is rewrited, and now filter is native Avisynth plugin (not C-plugin).</li>
      <li>Added parameter "<var>median</var>"  instead of DeSpotMedian function,</li>
      <li>Added parameter  "<var>show</var>" instead of DeSpotMark, DeSpotMap, DeSpotMedianMap functions.</li>
      <li>Replaced parameter "<var>mp</var>" to parameter "<var>merode</var>" (relative)</li>
      <li>Changed "<var>p1percent</var>" to integer</li>
      <li>Updated doc.</li>
    </ul>
  </li>
  <li>Changes 1.3 (June 7, 2004) from 1.2
(Fizick):
    <ul>
      <li>Removed parameter "<var>weak</var>" ( "<var>p1percent</var>" is more useful).</li>
      <li>Added parameter "<var>Dilate</var>" to enlarge spots.</li>
      <li>Fixed bug with processing field based video as interlaced  by default -
        now default for any source is progressive.</li>
      <li>Changed parameters order to more functional.</li>
      <li>Changed default values of some parameters to more optimal.</li>
      <li>Updated doc.</li>
    </ul>
  </li>
  <li>Changes 1.2 (June 01, 2004) from 1.1
(Fizick):
    <ul>
      <li>Added parameters <var>Ranked, weak, maxpts, p1percent</var>,</li>
      <li>changed mark mode to color spot with weak motion map.</li>
    </ul>
  </li>
  <li>Changes 1.1 (May 31, 2004) from 1.0:
    <ul>
      <li>Source now is compatible with MS VC6, VC7.</li>
    </ul>
  </li>
  <li>Changes 1.0 from 0.934 (Dec 30, 2003)
(Fizick) (not public):
    <ul>
      <li>Added "<var>tsmooth</var>" parameter for temporal smoothing in static areas.</li>
      <li>Changed filter name to DeSpot, filter file name to despot.dll,&nbsp;</li>
      <li>and function names:<br>
ConditionalDenoise to DeSpot,<br>
ConditionalDenoiseMark to DeSpotMark,<br>
ConditionalDenoiseMap to DeSpotMap,<br>
ConditionalMedian to DeSpotMedian,<br>
ConditionalMedianMap to DeSpotMedianMap.</li>
      <li>Corrected info.</li>
    </ul>
  </li>
  <li>Changes 0.934 from 0.93c (Dec 20, 2003)
(Fizick):
    <ul>
      <li>Added "<var>fitluma</var>" and "<var>blur</var>" parameters to reduce noticeability of deleted spots places.</li>
      <li>Remove "<var>per</var>" parameter used previously for that.</li>
      <li>New default value of "<var>mp</var>" parameter.</li>
    </ul>
  </li>
  <li>Changes 0.93c from 0.93b (Nov 30, 2003)
    <ul>
      <li>More short filter name ctmedian.dll</li>
      <li>Added version info to DLL</li>
    </ul>
  </li>
  <li>Changes 0.93d from 0.93b (Nov 13, 2003) (Fizick, non public):
    <ul>
      <li>Added "<var>per</var>" parameter for more smoothed specks perimeter.</li>
    </ul>
  </li>
  <li>Changes 0.93a from 0.93 (Nov 7, 2003) (Fizick, non public):
    <ul>
      <li>Added "<var>sign</var>" parameter for removing only black or white specks.</li>
      <li>non optimized general version only.</li>
    </ul>
  </li>
  <li>Changes 0.93 from 0.92 (Sep 27, 2003)
(Kevin Atkinson)
    <ul>
      <li>Fix another nasty bug.</li>
      <li>Included non optimized version.</li>
      <li>Expanded the manual a bit</li>
    </ul>
  </li>
  <li>Changes 0.92 from 0.91 (Sep 10, 2003)
(Kevin Atkinson)
    <ul>
      <li>Fixed nasty bug.</li>
    </ul>
  </li>
</ul>

<p><kbd>$English Date: 2006/12/15 19:29:25 $</kbd></p>
<p><kbd>Èeský pøeklad:25.2009</kbd></p>
</body>
</html>
 