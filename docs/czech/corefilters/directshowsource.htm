<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
   <title>DirectShowSource Avisynth Filter</title>
   <link rel="stylesheet" type="text/css" href="../../avisynth.css">
</head>
<body >
<h2>
<a NAME="DirectShowSource"></a>DirectShowSource
</h2>
<p><code>DirectShowSource </code>(<var>string filename, float "fps", bool "seek",
bool "audio", bool "video", bool "convertfps", bool
"seekzero", int "timeout", string "pixel_type", int
"framecount", string "logfile", int "logmask"</var>)
<p><code>DirectShowSource</code>&nbsp;ète soubor v parametru 
 &nbsp; <i><var>filename</var></i>&nbsp;s pou¾itím DirectShow, stejného 
multimediálního pøehrávacího systému, který
pou¾ívá Windows Media Player. Mù¾e èíst vìt¹inu&nbsp; formátù které&nbsp;Media Player umí pøehrát,
vèetnì&nbsp;MPEG, MP3, a QuickTime, stejnì jako&nbsp;AVI soubory&nbsp;které <tt>AVISource</tt>&nbsp;nepodporuje (jako DV typ 1, nebo 
soubory&nbsp;pou¾ívající pouze DirectShow kodeky). Zkuste nejdøív
pøeèíst&nbsp;AVI soubory&nbsp;pomocí <tt>AVISource</tt>    , a pokud to nepùjde&nbsp;pak
zkuste tento filtr.
<p>  Nìkolik upozornìní:
<ul>

  <li>
Nìkteré&nbsp;dekodéry (zvlá¹» MS MPEG-4) budou produkovat pøevrácené video hlavou dolù.
Budete muset pou¾ít&nbsp; <code><A href="flip.htm">FlipVertical</A></code>. 
  

<li>
DirectShow video dekodéry nemusí 
  podporovat&nbsp;pøesné vyhledávání (seekování) po snímcích. Vìt¹inou 
  vyhledávání bude&nbsp;fungovat, ale nìkdy nemusí. 

  <li>
            
  DirectShow video dekodéry nemusí sdìlit&nbsp;snímkovou frekvenci vstupního&nbsp;videa. Vìt¹inou to dìlají, ale ASF dekodér
ne. musíte zadat snímkovou frekvenci&nbsp;pomocí parametru fps, jako zde: <code>DirectShowSource</code> ("video.asf", 
  fps=15). 
  

<li>
Tato verze automaticky detekuje&nbsp;Microsoft DV 
  kodek a nastaví&nbsp;ho na dekódování v plném (místo v polovièním) rozli¹ení. 
  Pøedpokládám, ¾e nejsou&nbsp;námitky :-) 
  

<li>
Také 
se tato verze sna¾í vypnout jakékoliv odstranìní prokládání v dekodéru.</li>
</ul>
<p><var>fps</var>: Toto je obèas 
potøeba pro zadání snímkové frekvence videa. Pokud jsou frekvence snímkù nebo poèet snímkù nesprávné
(to se mù¾e stát&nbsp;u asf&nbsp;nebo mov klipù), pou¾ijte tuto volbu&nbsp;pro vynucení&nbsp;správné frekvence snímkù.</p>
<p><var>seek</var> = true (od <em>v2.53</em>): Toto je plná podpora 
vyhledávání&nbsp;(dostupná ve vìt¹inì formátù). Jestli se objeví problémy,&nbsp;zkuste nejdøív zapnout&nbsp;volbu&nbsp;
<var>seekzero</var>, pokud vyhledávání stále pùsobí problémy úplnì vypnìte
vyhledávání. S vypnutým vyhledáváním&nbsp;vrátí audio stream&nbsp;ticho a video stream poslední&nbsp;zpracovaný snímek, kdy¾ se
sna¾íte vyhledávat zpìt. V¹imnìte si, ¾e vyrovnávací pamì»&nbsp;Avisynthu&nbsp;mù¾e zajistit omezený pøístup k&nbsp;nìkolika
pøedchozím snímkùm, po kterých je vrácen poslední zpracovaný&nbsp;snímek.</p>
<p><var>audio</var> = true (od <em>v2.53</em>): Toto je&nbsp;audio&nbsp;podpora 
v&nbsp;DirectShowSource. DirectShowSource je schopen&nbsp;otevøít formáty&nbsp;jako WAV/DTS/AC3/MP3, za podmínky, ¾e
je mù¾ete pøehrát&nbsp;napøíklad ve WMP&nbsp;(pøesnìji: za podmínky, ¾e&nbsp;jsou správnì rendrovány v grapheditu).
Poøadí kanálù&nbsp;je stejné&nbsp;jako v [<a href="http://www.cs.bath.ac.uk/~jpff/NOS-DREAM/researchdev/wave-ex/wave_ex.html">wave-format-extensible
format</a>], proto¾e&nbsp;vstup je 
v¾dy&nbsp;dekomprimován do&nbsp;WAV. Pro více informací, se podívejte také na <A 
href="getchannel.htm"><CODE>GetChannel</CODE></A>     
          
 . AviSynth&nbsp;naèítá 8, 16, 24 a 32 bitové&nbsp;celé PCM vzorky, a&nbsp;desetinný PCM formát, a jakýkoliv poèet
kanálù.</p>
<p><var>video</var> = true (od <em>v2.52</em>      ):
Kdy¾ ho nastavíte&nbsp;na false, otevøete pouze&nbsp;audio.</p>
<p><var>convertfps</var> = false (od <em>v2.56</em>): Bude-li nastaven na true pøevede promìnnou&nbsp;snímkovou 
frekvenci&nbsp;videa (vfr)&nbsp;na
konstantní snímkovou frekvenci&nbsp;videa (cfr) duplikováním nebo vynecháním snímkù. To je u¾iteèné, kdy¾ chcete otevøít&nbsp;vfr
video (napøíklad mkv, rmvb, mp4, asf&nbsp;nebo wmv s hybridním videem)&nbsp;v AviSynthu. Nejvíce u¾iteèné je to&nbsp;kdy¾
je parametr&nbsp; <var>fps</var>&nbsp;nastaven
na&nbsp;nejmen¹í spoleèný násobek&nbsp;komponent vfr rychlostí,&nbsp;t.j. 120&nbsp;nebo 119.880.</p>
<p><var>seekzero</var> = false (od <em>v2.56</em> 
    ):&nbsp;Volba omezení vyhledávání pouze pøi pohybu zpìt k zaèátku.
Dovolí omezené vyhledávání v neindexovaných&nbsp;souborech ASF. Vyhledávání vpøed je samozøejmì proveden tvrdým zpùsobem&nbsp;(ètením v¹ech
snímkù).</p>
<p><var>timeout</var> = 60000 (v millisekundách; 60000 ms = 1 min) (od <em>v2.56</em>): K 
nastavení èasu vyèkání&nbsp;ve chvíli, kdy DirectShow&nbsp;odmítá rendrovat.&nbsp;Kladné hodnoty&nbsp;vrací prázdné snímky pro video a
ticho pro audio stream. Záporné hodnoty&nbsp;vyvolají výluku zpracování&nbsp;v Avisynthu.</p>
<p><var>pixel_type</var> (od <em>v2.56</em>): Typ pixelu výsledného klipu,&nbsp;mù¾e to 
být&nbsp;"YV12", "YUY2", "ARGB", "RGB32", "RGB24", "YUV", "RGB"&nbsp;nebo "AUTO". 
Ve výchozím stavu, jsou DirectShow filtry volné pro výzvu v¹ech jejich podporovaných media typù podle jejich volby. Nìkteré DirectShow
filtry to mají ¹patnì. Argument <b>pixel_type</b> omezuje pøípustný subformát&nbsp;video streamu&nbsp; pro
odsouhlasení&nbsp;vstupního&nbsp;pinu (IPin). V¹imnìte si, ¾e&nbsp;graph builder mù¾e pøidat pøevodník formátu aby splnil vá¹ po¾adavek,
proto se pøesvìdète, ¾e pou¾itý&nbsp;kodek mù¾e skuteènì dekódovat do vámi vybraného formátu.&nbsp;&nbsp;Pøevodník
formátu M$&nbsp;je dostateèný. Pseudo typy&nbsp;"YUV" a "RGB"&nbsp;omezují odsouhlasení&nbsp;do v¹ech podporovaných&nbsp;YUV&nbsp;nebo RGB
formátù.Pseudo-typ &quot;AUTO&quot; 
povoluje umo¾nìní pou¾ít v¹echny relevantní formáty podle poøadí vlastností
YV12, YUY2, ARGB, RGB32, RGB24. Mnohé DirectShow filtry to mají ¹patnì, co¾ je dùvod
proè to není zapnuto jako výchozí mo¾nost. Mo¾nost existuje tak¾e máte dostatek prostøedkù ovládání
pro podporu maximálního rozsahu filtrù pro pøedávání va¹ich médií. (Viz <a href="http://forum.doom9.org/showthread.php?t=143321" class="external text" title="http://forum.doom9.org/showthread.php?t=143321" rel="nofollow">diskuze</a>.)</p>
<p><var>framecount</var> (od <em>v2.57</em> ):&nbsp;Nìkdy je potøeba&nbsp;zadat poèet snímkù videa.&nbsp;Pokud je
snímková frekvence&nbsp;nebo poèet snímkù nesprávný&nbsp;(to se mù¾e stát&nbsp;u&nbsp;asf&nbsp;nebo mov klipù), pou¾ijte tuto volbu&nbsp;pro vynucení správného poètu
snímkù.&nbsp;Pokud je&nbsp; <var>fps</var>      &nbsp;zadáno, tak je pøizpùsobena také délka&nbsp;audio
streamu.</p>
<p><var>logfile</var> (od <em>v2.57</em>): Pou¾ijte tuto volbu pro zadání
názvu ladícího&nbsp;log souboru.</p>
<p><var>logmask</var> = 35 (od <em>v2.57</em>): Kdy¾ je zadaný&nbsp;log&nbsp;soubor, pou¾ijte&nbsp;tuto
volbu pro výbìr&nbsp;informací, které jsou zapisovány.
<center><table border="1">
<tr><th align=right>Hodnota</th><th>Data</th></tr>
<tr><td align=right>  1</td><td>Odsouhlasení formátu (Format Negotiation)</td></tr>
<tr><td align=right>  2</td><td>Obdr¾ené vzorky (Receive samples)</td></tr>
<tr><td align=right>  4</td><td>Volání snímkù/zvuku (GetFrame/GetAudio calls)</td></tr>
<tr><td align=right>  8</td><td>Zpìtná volání Directshow (Directshow callbacks)</td></tr>
<tr><td align=right> 16</td><td>Po¾adavky na Directshow (Requests to Directshow)</td></tr>
<tr><td align=right> 32</td><td>Chyby (Errors)</td></tr>
<tr><td align=right> 64</td><td>Výèet pou¾ití objektù COM (COM object use count)</td></tr>
<tr><td align=right>128</td><td>Nové objekty (New objects)</td></tr>
<tr><td align=right>256</td><td>Doplòkové&nbsp;informace (Extra info)</td></tr>
<tr><td align=right>512</td><td>Pøípady oèekávání (Wait events)</td></tr>
</table></center>Dejte dohromady&nbsp;hodnoty údajù, 
které potøebujete zapsat. Zadejte&nbsp;-1 pro zapsání v¹eho.&nbsp;Výchozí, 35, 
logs Format Negotiation, Received samples a Errors. t.j 1+2+32 
<h3>Pøíklady</h3>
<p>  Otvírá avi&nbsp;v prvním dostupném RGB formátu (bez zvuku):</p>
<pre>DirectShowSource(&quot;F:\TestStreams\xvid.avi&quot;, 
\       fps=25, audio=false, pixel_type=&quot;RGB&quot;)</pre>
<p>Otvírá&nbsp;DV klip pou¾itím&nbsp;MS DV dekodéru:</p>
<pre>DirectShowSource(&quot;F:\DVCodecs\Analysis\Ced_dv.avi&quot;) # MS-DV</pre>
<p>Otvírá mkv s promìnnou frekvencí snímkù&nbsp;jako &nbsp;119.88 cestou pøidání snímkù&nbsp;(zaji¹»uje synchronizaci):</p>
<pre>DirectShowSource(&quot;F:\Guides\Hybrid\vfr_startrek.mkv&quot;, 
\       fps=119.88, convertfps=true)</pre>
<p>Otvírá&nbsp;realmedia *rmvb klip:</p>
<pre>DirectShowSource(&quot;F:\test.rmvb&quot;, fps=24, convertfps=true)</pre>
<p>Otvírá&nbsp;soubor GraphEdit:</p>
<pre>V=DirectShowSource(&quot;F:\vid_graph.grf&quot;, audio=False) # pouze video (audio renderer odstranìn)
A=DirectShowSource(&quot;F:\aud_graph.grf&quot;, video=False) # pouze audio (video renderer odstranìn)
AudioDub(V, A)</pre>
<p>Podívejte se ní¾e na nìkteré pøíklady audia.</p>
<h3>Øe¹ení video a audio problémù</h3>
<p>              
     AviSynth se ve výchozím stavu pokusí otevøít pouze média, která
mù¾e otevøít bez problémù. Pokud nìjaké komponenta nejde otevøít,&nbsp;jednodu¹e nebude pøidána do výstupu. To také znamená,
¾e pokud je problém&nbsp;neuvidíte chybu. Pro obdr¾ení zprávy o chybì&nbsp;chybìjící komponenty&nbsp;pou¾ijte audio= false&nbsp;nebo
video=          false
a vypnìte&nbsp;komponentu, která ve skuteènosti pracuje. Tak&nbsp;AviSynth&nbsp;zobrazí zprávu o chybì komponenty, která nepracuje.</p>
<h4>RenderFile, the filter graph manager won't talk to me</h4>
<p> To je obecná&nbsp;chyba, která vzniká, kdy¾ 
DirectShow nemù¾e poskytnout ¾ádný formát&nbsp;èitelný pro&nbsp;AviSynth. Zkuste vytvoøit&nbsp;filter graph&nbsp;ruènì&nbsp;a podívejte se&nbsp;jestli mù¾ete vytvoøit&nbsp;filter graph,
který doruèí&nbsp;nìjaký výstup, který &nbsp;AviSynth&nbsp;otevøe.&nbsp;Pokud se to nepodaøí, budete muset stáhnout doplòující&nbsp;DirectShow
filtry, které umí doruèit správný materiál.</p>
<h4>Vzorkovací frekvence je ¹patná</h4>
<p>Nìkteré&nbsp;filtry mají&nbsp;problémy
se sdìlením správné vzorkovací frekvence, a upravit ji pøi skuteèném pøehrávání souboru. Nane¹tìstí&nbsp;není
zpùsob, kterým by to&nbsp;AviSynth opravil, po&nbsp;tom, kdy u¾ byl soubor otevøen. Pou¾ijte
<A href="assumerate.htm">AssumeSampleRate</A> a nastavte&nbsp;správnou 
vzorkovací frekvenci pro&nbsp;opravu tohoto&nbsp;problému.</p>
<h4>Mùj zvuk je trhaný</h4>
<p>Nane¹tìstí&nbsp;Directshow&nbsp;nevy¾aduje&nbsp;podporu&nbsp;pøesného vyhledávání vzorkù. Otevøete zvuk jiným zpùsobem, nebo&nbsp;demuxujte&nbsp;vá¹ video&nbsp;soubor a pøedlo¾te
ho&nbsp;AviSynthu jiným zpùsobem. Jinak je mo¾né zadat&nbsp; "seekzero =  true"&nbsp;nebo
"seek =   false" jako&nbsp;parametry,&nbsp;nebo pou¾ít&nbsp; filtr
<A href="ensuresync.htm">EnsureVBRMP3Sync</A>&nbsp;pro 
vynucení&nbsp;lineárního pøístupu&nbsp;do Directshow audio streamu.</p>
<h4><span class="mw-headline">Mùj zvuk je nesynchronní s videem</span></h4>
<p>To se mù¾e stát zvlá¹tì u WMV, zøejmì kvùli vracené promìnné frekvenci snímkù
videa. Urèete jaká by mìla být fps a nastavte ji explicitnì,
a také pou¾ijte &quot;ConvertFPS&quot; pro její vynucení aby zùstala konstantní. A
<a href="ensuresync.htm">EnsureVBRMP3Sync</a>  sni¾uje problémy s promìnnou
rychlostí audia.</p>
<pre>DirectShowSource(&quot;video.wmv&quot;, fps=25, ConvertFPS=True)
EnsureVBRMP3Sync() </pre>
<h4>Moje pøehrávání&nbsp;ASF&nbsp;zaèíná rychle a konèí pomalu</h4>
<p>Microsoft&nbsp;se ve své nekoneèné moudrosti 
rozhodl&nbsp;zmìnit&nbsp;implementovaný ASF stream timing&nbsp;v ASF demuxeru. A proto¾e&nbsp;není mo¾né&nbsp;uvolnit soubory formátu ASF&nbsp;rychleji ne¾ v
reálném èase. To je nejvíce vidìt&nbsp;pøi startu procesu zpracování streamù, obvykle&nbsp;po otevøení&nbsp;skriptu Avisynthu&nbsp;potøebujete
nìjaký èas, aby se zkonfiguroval vá¹ video&nbsp;editor, a mezitím&nbsp;muxer stále hromadí
<i>credit</i> èasu. Kdy¾ pak zaènete zpracování&nbsp;va¹eho streamu,
bì¾í s maximální rychlostí&nbsp;dokud nedo¾enete reálný èas, v tomto&nbsp;místì se zpomalí&nbsp;na&nbsp;reálnou rychlost materiálu
zdroje. Tato zvlá¹tnost&nbsp;znemo¾òuje Avisynthu&nbsp;pøetaktovat frekvenci&nbsp;24fps ASF materiálu na 25fps pro&nbsp;pøímé pøehrávání v
PAL.</p>
<h3>Obecné úlohy</h3>
<p>Tato kapitola&nbsp;popí¹e&nbsp;rùzné úlohy, které nemusí být&nbsp;100% zøejmé. :)</p>
<h4>Otvírání&nbsp;GRF souborù</h4>
<p>GraphEdit GRF-soubory jsou&nbsp;automaticky 
detekovány&nbsp;podle pøípony&nbsp;.grf&nbsp;&nbsp;a pøímo naèteny&nbsp;pomocí DirectShowSource.&nbsp;Aby byl AviSynth schopen pøipojit se k nìmu, musíte nechat v&nbsp;GraphEditu&nbsp;otevøené
piny&nbsp;(spojovací body) tìch typù medií, ke kterým se doká¾e pøipojit také&nbsp;AviSynth. AviSynth se nubude
sna¾it odpojit ¾ádné filtry, tak¾e je dùle¾ité&nbsp;aby byl správný typ&nbsp;výstupu. DirectShowSource&nbsp;pøijímá
pouze&nbsp;YV12, YUY2, ARGB, RGB32 a RGB24 video formáty a 32, 24, 16 a 8 bitové PCM
a IEEE FLOAT audio formáty.</p>
<p>Daný&nbsp;GRF-soubor musí vyvést&nbsp;jen jeden výstup audio sreamu nebo
video streamu, aby se vyhnul nedorozumìní, kdy se&nbsp;Directshowsource pokou¹í pøipojit&nbsp;k
va¹emu otevøenému pinu(ùm). Od verze&nbsp;2.57 je toto&nbsp;jednostreamové omezení nezbytné.
<h4>
Smíchání -sní¾ení poètu- &nbsp;kanálù (Downmixing) AC3&nbsp;na stereo</h4>Ve 
skuteènosti existují dva
zpùsoby jak to provést. Prvním je nastavení&nbsp;smíchání v konfiguraci&nbsp;va¹eho AC3 dekodéru samotného, a druhým zpùsobem
je&nbsp;pou¾ití externího&nbsp;smì¹ovaèe (downmixer)&nbsp;od "Trombettworks":
<p>1) Nainstalujte&nbsp;AC3filter.&nbsp;Otevøete
AC3&nbsp;soubor ve&nbsp;WMP6.4 a vyberte&nbsp;vlastnosti souboru. Nastavte&nbsp;výstup AC3Filtru&nbsp;na <b>2/0 - stereo</b>. 
Pokud chcete nejvy¹¹í mo¾nou kvalitu, vyberte&nbsp;PCM Float&nbsp;jako Sample format.</p>
<IMG height=435 src="../../english/pictures/corefilters/ac3downmix1a.jpg" width=425 border=0>
<IMG height=487 src="../../english/pictures/corefilters/ac3downmix1b.jpg" width=628 border=0>
<p>  Vytvoøte následující skript:
<pre>v = Mpeg2Source(&quot;e:\movie.d2v&quot;)
a = DirectShowSource(&quot;e:\Temp\Test2\test.ac3&quot;)
AudioDub(v,a)</pre> Nakonec&nbsp;otevøete skript ve VirtualDubu&nbsp;a pøeveïte&nbsp;audio
stream do MP3 (samozøejmì mù¾ete také demuxovat&nbsp;smíchaný&nbsp;(downmixed) WAV stream&nbsp;pokud je potøeba).
<p>2) Registrujte&nbsp;directshow filtr <a href="http://www.trombettworks.com/directshow.php">
<cite>Channel Downmixer by Trombettworks</cite></a> (ve Start -&gt; Spustit):</p>
<p>&nbsp;&nbsp;&nbsp; <i>regsvr32 ChannelDownmixer.ax</i>
<p>Otevøete&nbsp;AC3 soubor&nbsp;ve WMP6.4 a vyberte&nbsp;vlastnosti souboru.
Nastavte výstup&nbsp;AC3Filtru&nbsp;na <b>3/2+SW 5.1 channels</b> (tento downmixer&nbsp;nepodporuje PCM Float,&nbsp;proto je zde&nbsp;zvoleno&nbsp;PCM 16 bit). Ve vlastnostech&nbsp; downmixeru,
by mìl být poèet vstupních a výstupních kanálù urèen automaticky. Zkontrolujte
jestli je to opravdu správnì.
<br><br>
<IMG height=435 src="../../english/pictures/corefilters/ac3downmix2a.jpg" width=425 border=0>&nbsp;
<IMG height=487 src="../../english/pictures/corefilters/ac3downmix2b.jpg" width=628 border=0>

<p> <IMG height=595 src="../../english/pictures/corefilters/ac3downmix2c.jpg" width=695 border=0>

<p>  Vytvoøte následující skript:
<pre>v = Mpeg2Source(&quot;e:\movie.d2v&quot;)
a = DirectShowSource(&quot;e:\Temp\Test2\test.ac3&quot;)
AudioDub(v,a)</pre> Nakonec&nbsp;otevøete skript ve VirtualDubu&nbsp;a pøeveïte&nbsp;audio
stream do MP3 (samozøejmì mù¾ete také demuxovat&nbsp;smíchaný&nbsp;(downmixed) WAV stream&nbsp;pokud je potøeba).
<p>   Z nìjakého dùvodu mi to nejde udìlat&nbsp;s DTS streamy :(</p>
<p><b>Zmìny</b></p>
<table border="1" width="40%">
  <tr>
    <td rowspan=4 width="5%">v2.56</td>
    <td width="50%"> convertfps&nbsp;pøevádí vfr na&nbsp;konstantní cfr pøidáním snímkù</td>
  </tr>
  <tr>
    <td width="50%">seekzero omezuje vyhledávání jen smìrem k zaèátku</td>
  </tr>
  <tr>
    <td width="50%">timeout ovládá&nbsp;odezvu&nbsp;na neposlu¹né grafy</td>
  </tr>
  <tr>
    <td width="50%">  pixel_type zadává/omezuje výstupní formát&nbsp;pixelu</td>
  </tr>
  <tr>
    <td rowspan=2 width="5%">v2.57</td>
    <td width="50%">   framecount pøepisuje délku streamù.</td>
  </tr>
  <tr>
    <td width="50%">logfile a logmask ukazují ladící protokolování (záznamy).</td>
  </tr>
</table>
<p><kbd>$English Date: 2009/07/12 12:49:34 $</kbd></p>
<P><KBD>Èeský pøeklad:18.9.2009</KBD></P>
<form><input TYPE="button" VALUE="Zpìt" onClick="history.go(-1)"></form>
</body>
</html>
















